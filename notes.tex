\documentclass[10pt]{amsart}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsmath,amsthm,amssymb,stmaryrd,color,graphicx}
\usepackage{setspace}
\usepackage{bussproofs}
\usepackage{array}
\usepackage{comment}
\usepackage[protrusion=true,expansion=true]{microtype}
\usepackage{hyperref}

\usepackage{tikz}
\usetikzlibrary{calc,shapes.callouts,shapes.arrows}
\newcommand{\hcancel}[5]{%
    \tikz[baseline=(tocancel.base)]{
        \node[inner sep=0pt,outer sep=0pt] (tocancel) {#1};
        \draw[red, line width=0.5mm] ($(tocancel.south west)+(#2,#3)$) -- ($(tocancel.north east)+(#4,#5)$);
    }%
}

\theoremstyle{definition}
\newtheorem{defn}{Definition}[section]
\newtheorem{ex}[defn]{Example}

\theoremstyle{plain}

\newtheorem{prop}[defn]{Proposition}
\newtheorem{cor}[defn]{Corollary}
\newtheorem{lemma}[defn]{Lemma}
\newtheorem{thm}[defn]{Theorem}

\theoremstyle{remark}
\newtheorem{rem}[defn]{Remark}

\newcommand{\ZZ}{\mathbb{Z}}
\renewcommand{\AA}{\mathbb{A}}
\newcommand{\C}{\mathcal{C}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\G}{\mathcal{G}}
\renewcommand{\O}{\mathcal{O}}
\renewcommand{\P}{\mathcal{P}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\GG}{\mathbb{G}}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\id}{\mathrm{id}}
\newcommand{\Aut}[1]{\operatorname{Aut}(#1)}
\newcommand{\GL}{\mathrm{GL}}
\newcommand{\freist}{\_{}\_{}}
\newcommand{\Set}{\mathrm{Set}}
\newcommand{\Grp}{\mathrm{Grp}}
\newcommand{\Vect}{\mathrm{Vect}}
\newcommand{\Sh}{\mathrm{Sh}}
\newcommand{\Zar}{\mathrm{Zar}}
\newcommand{\Sch}{\mathrm{Sch}}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\colim}{colim}
\newcommand{\?}{\,{:}\,}
\renewcommand{\_}{\mathpunct{.}\,}
\newcommand{\speak}[1]{\ulcorner\text{\textnormal{#1}}\urcorner}
\newcommand{\Ll}{:\Longleftrightarrow}

\title{Using the internal language of toposes in algebraic geometry}
\author{Ingo Blechschmidt}
\email{iblech@web.de}

\begin{document}
\maketitle

\begin{abstract}
  There are several important topoi associated to a scheme, for instance the
  petit and gros Zariski topoi. These come with an internal mathematical language
  which closely resembles the usual formal language of mathematics, but is ``local
  on the base scheme'':

  For example, from the internal perspective, the structure sheaf looks like an
  ordinary local ring (instead of a sheaf of rings with local stalks) and vector
  bundles look like ordinary free modules (instead of sheaves of modules
  satisfying a certain condition). The translation of internal statements and
  proofs is facilitated by an easy mechanical procedure.

  These expository notes give an introduction to this topic and show how the internal
  point of view can be exploited to give simpler definitions and more conceptual
  proofs of the basic notions and observations in algebraic geometry. No prior
  knowledge about topos theory and formal logic is assumed.
\end{abstract}

\tableofcontents

\section{Introduction}

\section{Kripke--Joyal semantics}

Let~$X$ be a topological space. Later, $X$ will be the underlying space of a
scheme.

\begin{defn}[Kripke--Joyal semantics of a sheaf topos]The meaning of 
\[ U \models \varphi \quad\text{(``$\varphi$ holds on $U$'')} \]
for open subsets~$U \subseteq X$ and formulas~$\varphi$ is given by
the following rules, recursively in the structure of~$\varphi$:
\[ \renewcommand{\arraystretch}{1.3}\begin{array}{@{}lcl@{}}
  U \models f = g \? \F &\Ll& f|_U = g|_U \in \Gamma(U, \F) \\
  U \models \varphi \wedge \psi &\Ll&
    \text{$U \models \varphi$ and $U \models \psi$} \\
  U \models \varphi \vee \psi &\Ll&
    \hcancel{\text{$U \models \varphi$ or $U \models \psi$}}{0pt}{3pt}{0pt}{-2pt} \\
  && \text{there exists a covering $U = \bigcup_i U_i$ s.\,th. for all~$i$:} \\
  && \quad\quad \text{$U_i \models \varphi$ or $U_i \models \psi$} \\
  U \models \varphi \Rightarrow \psi &\Ll&
    \text{for all open~$V \subseteq U$: } 
  \text{$V \models \varphi$ implies $V \models \psi$} \\
  U \models \forall f \? \F\_ \varphi(f) &\Ll&
    \text{for all sections~$f \in \Gamma(V, \F), V \subseteq U$: $V \models
    \varphi(f)$} \\
  U \models \exists f \? \F\_ \varphi(f) &\Ll&
    \hcancel{\text{there exists a section~$f \in \Gamma(U,\F)$ s.\,th. $U
    \models \varphi(f)$}}{0pt}{3pt}{0pt}{-2pt} \\
  &&
    \text{there exists a covering $U = \bigcup_i U_i$ s.\,th. for all~$i$:} \\
  && \quad\quad \text{there exists~$f_i \in \Gamma(U_i, \F)$ s.\,th.
  $U_i \models \varphi(f_i)$} \\
  U \models \forall \F\_ \varphi(\F) &\Ll&
    \text{for all sheaves $\F$ on $V$, $V \subseteq U$: $V \models \varphi(\F)$} \\
  U \models \exists \F\_ \varphi(\F) &\Ll&
    \text{there exists a covering $U = \bigcup_i U_i$ s.\,th. for all~$i$:} \\
  && \quad\quad \text{there exists a sheaf~$\F_i$ on~$U_i$ s.\,th.
  $U_i \models \varphi(\F_i)$}
\end{array} \]
\end{defn}

\begin{rem}The last two rules, concerning \emph{unbounded quantification}, are
not part of the classical Kripke--Joyal semantics, but instead of Mike
Shulman's stack semantics~\cite{shulman:stack}, a slight extension. They are
needed so that we can formulate universal properties in the internal
language.
\end{rem}

The rules are not all arbitrary. They are finely concerted to make the
following propositions true, which are crucial for a proper appreciation of the
internal language.

\begin{prop}[Locality of the internal language]
Let~$U = \bigcup_i U_i$ be covered by open subsets. Let~$\varphi$
be a formula. Then
\[ U \models \varphi \qquad\text{iff}\qquad
  \text{$U_i \models \varphi$ for each $i$}. \]
\end{prop}
\begin{proof}Induction on the structure of~$\varphi$. Note that the canceled
rules would make this proposition false.\end{proof}

\begin{prop}[Soundness of the internal language]
If a formula~$\varphi$ implies a further formula~$\psi$ in intuitionistic logic, then
\[ U \models \varphi \qquad\text{implies}\qquad
  U \models \psi. \]
\end{prop}
\begin{proof}
Proof by induction on the structure of formal intuitionistic proofs; we are to
show that any inference rule of intuitionistic logic is satisfied by the
Kripke--Joyal semantics. For instance, there is the following rule governing
disjunction:
\begin{quote}
If~$\varphi \vee \psi$ holds, and both $\varphi$ and $\psi$ imply a further
formula~$\chi$, then~$\chi$ holds.
\end{quote}
So we are to prove that if~$U \models \varphi \vee \psi$, $U \models (\varphi
\Rightarrow \chi)$, and $U \models (\psi \Rightarrow \chi)$, then $U \models \chi$.
This is done as follows: By assumption, there exists a covering~$U = \bigcup_i
U_i$ such that on each~$U_i$, $U_i \models \varphi$ or $U_i \models \psi$.
Again by assumption, we may conclude that~$U_i \models \chi$ for each~$i$. The statement
follows because of the locality of the internal language.

A complete list of which rules are to prove is
in~\cite[D1.3.1]{johnstone:elephant}.
\end{proof}

\begin{itemize}
\item geometric formulas
\item geometric constructions
\item simplification rules
\item first steps: invertibility, nilpotency (needed later)
\end{itemize}

\section{Sheaves of rings}

\subsection{Reducedness} Recall that a scheme~$X$ is \emph{reduced} if and only
if all stalks~$\O_{X,x}$ are reduced rings. Since the condition on a ring~$R$
to be reduced is a geometric implication,
\[ \forall s\?R\_ s^2 = 0 \Longrightarrow s = 0, \]
we immediately obtain the following characterization of reducedness in the
internal language:
\begin{prop}A scheme~$X$ is reduced iff, from the internal point of view, the
ring~$\O_X$ is reduced.\end{prop}


\subsection{Locality} Recall the usual definition of a local ring: a ring
possessing exactly one maximal ideal. This is a higher-order condition and in
particular not of a geometric form. Therefore, for our purposes, it's better to
adopt the following elementary definition of a local ring.
\begin{defn}A \emph{local ring} is a ring~$R$ such that~$1 \neq 0$ in~$R$ and
for all~$x,y \in R$
\[ \text{$x+y$ invertible} \quad\Longrightarrow\quad
  \text{$x$ invertible}\ \vee\ \text{$y$ invertible}. \]
\end{defn}
In classical logic, it's an easy exercise to show that this definition is
equivalent to the usual one. In intuitionistic logic, we would need to be
more precise in order to even state the question of equivalence, since
intuitionistically, the notion of a maximal ideal bifurcates into several
non-equivalent notions.

\begin{prop}In the internal language of a scheme~$X$ (or a locally ringed
space), the ring~$\O_X$ is a local ring.\end{prop}
\begin{proof}The stated locality condition is a conjunction of two geometric
implications (the first one being~$1 = 0 \Rightarrow \bot$, the second being
the displayed one) and holds on each stalk.\end{proof}


\subsection{Field properties} From the internal point of view, the structure
sheaf~$\O_X$ of a scheme~$X$ is \emph{almost} a field, in the sense that any
element which is not invertible is nilpotent. This is a genuine property of
schemes, not shared with general locally ringed spaces.

\begin{prop}Let~$X$ be a scheme. Then
\[ \Sh(X) \models \forall s\?\O_X\_ \neg(\speak{$s$ invertible}) \Rightarrow
\speak{$s$ nilpotent}. \]
\end{prop}
\begin{proof}By the locality of the internal language and since~$X$ can be
covered by open affine subsets, it's enough to show that for any affine
scheme~$X = \Spec A$ and global function~$s \in \Gamma(X,\O_X) = A$ it holds
that
\[ X \models \neg(\speak{$s$ invertible}) \quad\text{implies}\quad
  X \models \speak{$s$ nilpotent}. \]
The meaning of the antecedent is that any open subset on which~$s$ is
invertible is empty. So in particular, the standard open subset~$D(s)$ is
empty. Therefore~$s$ is an element of any prime ideal of~$A$ and thus
nilpotent. This implies the a priori weaker statement~$X \models \speak{$s$
nilpotent}$ (which would allow~$s$ to have different indices of nilpotency on
an open covering).
\end{proof}

\begin{cor}Let~$X$ be a scheme. If~$X$ is reduced, the ring~$\O_X$ is a field
from the internal point of view, in the sense that
\[ \Sh(X) \models \forall s\?\O_X\_ \neg(\speak{$s$ invertible}) \Rightarrow
s=0. \]
The converse holds as well.\end{cor}
\begin{proof}We can prove this purely in the internal language: It suffices to
give an intuitionistic proof of the fact that a local ring which satisfies the
condition of the previous proposition fulfills the stated field condition if
and only if it is reduced. This is straightforward.
\end{proof}

This field property is very useful. We will put it to good use when giving a
simple proof of the fact that~$\O_X$-modules of finite type on a reduced scheme
are locally free on a dense open subset (proposition~\ref{modules:densefree}).

\begin{itemize}
\item Remark that intuitionistically, the notion of a field bifurcates into
several inequivalent notions
\item discreteness
\end{itemize}

\section{Sheaves of modules}
\begin{itemize}
\item of finite type, of finite presentation, coherent
\item basic lemmas
\item flatness
\item important hard exercise
\end{itemize}

\section{Rational functions and Cartier divisors}
\begin{itemize}
\item internal definition of $K_X$
\item internal definition of Cartier divisors
\item correspondence between Cartier divisors and sub-$O_X$-modules of $K_X$
\end{itemize}

\section{Relative spectrum}
\begin{itemize}
\item ...
\end{itemize}

\section{Modalities}
\begin{itemize}
\item negneg
\item spreading of properties from stalk to neighbourhood
\item internal sheafification
\end{itemize}

\section{Unsorted}
\begin{itemize}
\item ``functoriality''
\item KÃ¤hler differentials
\item completion of the natural numbers, rank function
\item closed and open subschemes
\item reduced closed subscheme
\item Koszul resolution
\item meta properties, uses (e.g. nilpotent on stalks iff globally nilpotent,
some lemmas about limits of modules)
\item locally small categories
\item big Zariski topos
\item open/closed immersions
\item morphisms of schemes...
\item proper maps...
\item limits and colimits...
\item related work: Mulvey/Burden, Wraith, Vickers, the Bohr topos crew, Awodey, ...
\end{itemize}

\end{document}
