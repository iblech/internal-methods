\documentclass{ws-rv9x6}
\usepackage[onethmnum]{ws-rv-thm}
\usepackage{ws-rv-van}
\usepackage{mathtools,stmaryrd,xspace}

\usepackage[normalem]{ulem}
\usepackage{tikz}
\usetikzlibrary{calc}
\newcommand{\hcancel}[5]{%
  \tikz[baseline=(tocancel.base)]{
    \node[inner sep=0pt,outer sep=0pt] (tocancel) {#1};
    \draw[red!80, line width=0.4mm] ($(tocancel.south west)+(#2,#3)$) -- ($(tocancel.north east)+(#4,#5)$);
  }%
}

\makeindex
%\newindex{aindx}{adx}{and}{Author Index}       % author index
%\renewindex{default}{idx}{ind}{Subject Index}  % subject index

\newcommand{\A}{\mathcal{A}}
\newcommand{\B}{\mathcal{B}}
\newcommand{\C}{\mathcal{C}}
\newcommand{\M}{\mathcal{M}}
\renewcommand{\AA}{\mathbb{A}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\G}{\mathcal{G}}
\newcommand{\J}{\mathcal{J}}
\newcommand{\GG}{\mathbb{G}}
\renewcommand{\O}{\mathcal{O}}
\newcommand{\K}{\mathcal{K}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\TT}{\mathbb{T}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\CC}{\mathbb{C}}
\renewcommand{\P}{\mathcal{P}}
\newcommand{\aaa}{\mathfrak{a}}
\newcommand{\bbb}{\mathfrak{b}}
\newcommand{\ppp}{\mathfrak{p}}
\newcommand{\qqq}{\mathfrak{q}}
\newcommand{\mmm}{\mathfrak{m}}
\newcommand{\fff}{\mathfrak{f}}
\newcommand{\defeq}{\vcentcolon=}
\newcommand{\defeqv}{\vcentcolon\equiv}
\newcommand{\Sh}{\mathrm{Sh}}
\newcommand{\GL}{\mathrm{GL}}
\newcommand{\Zar}{\mathrm{Zar}}
\newcommand{\op}{\mathrm{op}}
\newcommand{\Set}{\mathrm{Set}}
\newcommand{\Eff}{\mathrm{Ef{}f}}
\newcommand{\Sch}{\mathrm{Sch}}
\newcommand{\Aff}{\mathrm{Aff}}
\newcommand{\Ring}{\mathrm{Ring}}
\newcommand{\LocRing}{\mathrm{LocRing}}
\newcommand{\LRS}{\mathrm{LRS}}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\Spec}{\mathrm{Spec}}
\newcommand{\Gal}{\mathrm{Gal}}
\newcommand{\lra}{\longrightarrow}
\newcommand{\RelSpec}{\operatorname{Spec}}
\renewcommand{\_}{\mathpunct{.}}
\newcommand{\?}{\,{:}\,}
\newcommand{\speak}[1]{\ulcorner\text{\textnormal{#1}}\urcorner}
\newcommand{\ul}[1]{\underline{#1}}
\newcommand{\affl}{\ensuremath{{\ul{\ensuremath{\AA}}^1}}}
\newcommand{\Ll}{\text{iff}}
\newcommand{\inv}{inv.\@}
\newcommand{\seq}[1]{\mathrel{\vdash\!\!\!_{#1}}}
\newcommand{\hg}{\mathbin{:}}  % homogeneous coordinates
\newcommand{\brak}[1]{{\llbracket{#1}\rrbracket}}
\newcommand{\pt}{\mathrm{pt}}
\newcommand{\Loc}{\mathrm{Loc}}
\newcommand{\Top}{\mathrm{Top}}
\newcommand{\BPIT}{\textsc{bpit}\xspace}

\begin{document}

\chapter{Generalized spaces for constructive algebra}

\author[I. Blechschmidt]{Ingo Blechschmidt}
% \index[aindx]{Blechschmidt, I.}

\address{Universität Augsburg \\
Institut für Mathematik \\
Universitätsstr. 14 \\
86159 Augsburg, Germany}

\begin{abstract}
XXX
\end{abstract}
\body

%\tableofcontents

\section{Locales}

The notion of \emph{space} is fundamental to large parts of mathematics. It
exists in various flavors, ranging from the basic cartesian spaces~$\RR^n$ to
the more general metric and topological spaces and also including several more
and slightly exotic flavors such as the diffeological spaces of differential topology.

Common to all of the mentioned flavors of space is that \emph{points are their
building blocks}: Cartesian, metric, topological and diffeological spaces are,
first and foremost, sets of points. Their spatial structure -- a metric, a
topology or a diffeology -- is additional data to the underlying set:

\begin{definition}A \emph{metric space} consists of a set~$X$ of points
together with a metric~$d : X \times X \to \RR_{\geq 0}$ satisfying the metric
axioms. \end{definition}

\begin{definition}A \emph{topological space} consists of a set~$X$ of points
together with a set~$\O(X) \subseteq \P(X)$ of point sets which are deemed
\emph{open} such that (arbitrary, set-indexed) unions and finite intersections
of open sets are open.
\end{definition}

Locales are a further and particularly unique flavor of the notion of space
which turn this classical picture upside down: Locales embrace \emph{opens
instead of points as primitive building blocks}. With locales, points are a
derived concept. In particular, the opens of a locale are not sets of points;
in fact, they needn't be sets of anything in peculiar.

The formal definition of a locale will be given below as
Definition~\ref{defn:locale}, but before we will review examples and comment on
the relevance of locales to constructive mathematics.


\subsection{Spaces without points}
\label{sect:examples-no-points}

A metric or topological space without any points is not very interesting: It is
empty, and up to isomorphism there is only one such space. In contrast, a
locale can be nontrivial even if it does not contain any points. This
phenomenon is one instance of the general guiding principle that relinquishing
points increases flexibility.

\paragraph{The locale of surjections~$\NN \twoheadrightarrow \RR$.} As is
well-known, there are no surjections from~$\NN$ to~$\RR$.\footnote{More
precisely, it is a theorem of classical mathematics that the reals are
uncountable in the sense of admitting no surjection from the naturals. The
situation is more subtle in constructive mathematics. Firstly, in the absence
of countable choice, the reals bifurcate into several distinct flavors, hence
one needs to state which flavor of the reals one is referring to. Secondly, all
known proofs of the uncountability of the Cauchy and the Dedekind reals assume
either the law of excluded middle or the axiom of countable choice. In the
absence of either of these axioms, only the MacNeille reals are known to be
uncountable~\cite{blechschmidt-hutzler:macneille}.} Hence there is no
interesting topological space of those surjections. However, there is a
well-defined and nontrivial locale~$X$ of those surjections.

The points of~$X$ are in canonical one-to-one correspondence with the
surjections~$\NN \twoheadrightarrow \RR$, hence~$X$ does not have any points.
But this locale does have uncountably many basic opens~$U_{n,x}$, where~$n$
ranges over the naturals and~$x$ ranges over the reals. We picture~$U_{n,x}$ as
the open of those surjections~$f$ for which~$f(n) = x$, we can compute with
these opens and consider functions on~$X$. For instance:
\begin{enumerate}
\item If~$x \neq y$, then the intersection of~$U_{n,x}$ with~$U_{n,y}$
is truly empty.
\item The union of the~$U_{n,x}$, where~$x$ is a fixed real
number and~$n$ ranges over the naturals, is all of~$X$. No finite number
of these opens covers~$X$, hence~$X$ is not compact.
\item For any real~$x$, there is a well-defined continuous function from~$X$ to
(the localic version of) the naturals which, on the level of points, would map
a surjection~$f : \NN \to \RR$ to the smallest preimage of~$x$.
\item There is a well-defined continuous function from~$X$ to (the localic
version of) the reals which, on the level of points, would map a surjection~$f$
to the number~$\sum_{n=0}^\infty 2^{-n} \arctan(f(n))$. Unlike the previous
example, this function is not locally constant.
\item\label{item:intersection-sublocales} The locale~$X$ is a sublocale of the
locale~$Y$ of arbitrary functions~$\NN \to \RR$ (which can also be realized as
a topological space). It can be obtained as the intersection of the uncountably
many sublocales~$Y_x$, where~$Y_x$ is the sublocale of~$Y$ consisting of those
functions which hit the real~$x$.
\item A certain sublocale of~$X$, the locale~$X'$ of those functions~$\NN \to
\RR$ for which any real has infinitely many preimages, has a fractal nature: It
is covered by the~$U_{0,x}$, where~$x$ ranges over the reals; the pairwise
intersection of these opens is (truly) empty; and they are each isomorphic
to~$X'$ -- on the level of points, by mapping a surjection~$f$ in~$U_{0,x}$ to
the surjection~$(n \mapsto f(n+1))$.
\end{enumerate}

There is nothing special about the real numbers which makes this example work;
in fact, the example works just as well with any set~$M$ in place of the reals.
For any set~$M$, there is a locale of surjections~$\NN \twoheadrightarrow M$,
and this locale is trivial (isomorphic to the empty locale) if and only if~$M$
is empty. Locales of these kind are used as an important reduction step in the
extension of Grothendieck's Galois theory by Joyal and
Tierney~\cite[Section~V.3]{joyal-tierney:galois-theory}.


\paragraph{Intersection of dense sublocales.} In ordinary topology, the
intersection of dense subspaces need not be dense. A simple example is the
intersection of~$\QQ$ with its complement in~$\RR$. In contrast, the
intersection of (even an arbitrary set of) dense sublocales is always again
dense -- even if the intersection might well have no points.

For instance, the locale-theoretic intersection of (the localic version
of)~$\QQ$ with its complement does not have any points and is dense in (the
localic version of) the reals. Intuitively, while these two sublocales do not
have any points in common, there still is nontrivial ``localic glue''.

% This basic fact about locale-theoretic denseness illustrates a more general
% phenomenon of locales: Locales tend to enjoy better formal properties.

Another example is given by item~(\ref{item:intersection-sublocales}) above:
Each of the sublocales~$Y_x$ is dense in~$Y$, hence their intersection~$X$ is
so as well.


\paragraph{The Banach--Tarski paradox.} The Banach--Tarski paradox is the
unintuitive statement that a three-dimensional solid ball in~$\RR^3$ of
radius~$r$ can be partitioned into six disjoint subsets in such a way that
rearranging those subsets using only Euclidean motions yields two disjoint
solid balls of radius~$r$ each. The axiom of choice is required to construct
these subsets, and the Banach--Tarski paradox is not in
contradiction with the basic properties of the (Lebesgue) measure in~$\RR^3$
because these intermediate subsets are not measurable.

The traditional way to avoid the Banach--Tarski paradox is to adopt the
\emph{axiom of determinacy} instead of the axiom of choice. Just as the axiom
of choice posits that a certain property of the finite domain also holds for the
infinite, the axiom of determinacy is a certain statement whose finitary
analogue is provable in unadorned Zermelo--Fraenkel set theory. It entails that
all subsets of~$\RR^n$ are measurable.

The Banach--Tarski paradox can also be avoided by adopting a localic point of
view: While the localic counterparts of the six pieces do not have any points
in common, the locale-theoretic pairwise intersections are still nontrivial.
Hence one would not expect the rearrangement of these sublocales to have the
same volume as the original solid ball. [XXX: give reference]


\paragraph{Random sequences.} XXX


\subsection{Constructive concerns}

By relinquishing points, locales provide a more flexible notion of space.
Section~\ref{sect:examples-no-points} illustrates[XXX:word] this observation
with several examples of nontrivial locales without any points. Constructive
mathematics gives a further, orthogonal motivation to study locales: There are
situations in which the relevant spaces do have enough points, but only if one
subscribes to the axiom of choice or similar non-constructive principles. In
these situations, the pointfree approach allowed by locales can help to give
constructive versions of classical results.

XXX ideal objects

\paragraph{Compactness of the unit interval.} The unit interval, when realized
as a topological space, can fail to be be compact in constructive
mathematics. For instance, it fails in the Russian school because the Kleene
tree provides a computable open covering of~$[0,1]$ with no computable finite
subcovering [XXX: reference].

In contrast, the localic version of the unit interval is always compact. The
proof is by an explicit computation with its basic opens. [XXX: reference]

More generally, Tychonoff's theorem that the product of any number of compact
topological spaces is again compact is equivalent to the axiom of choice. Its
localic counterpart, the statement that the product of any number of compact
locales is again compact, can be verified without any nonconstructive
principles. [XXX: reference]

\paragraph{Galois theory.} Let~$L|k$ be a Galois extension. The
fundamental theorem of Galois theory states that there is a bijection between
the intermediate extensions~$L|E|k$ and the closed subgroups of the topological
Galois group~$\Gal(L|k)$. The bijection maps an intermediate extension~$L|E|k$
to the subgroup~$\Gal(L|E)$ and its inverse maps a closed subgroup~$H \subseteq
\Gal(L|k)$ to the intermediate extension~$L^H$.

Much of the proof of the fundamental theorem of Galois theory is constructive,
but some parts use the law of excluded middle and Zorn's lemma in order to
construct certain extensions of given field homomorphisms.\footnote{For
instace, the statement~$E \subseteq L^{\Gal(L|E)}$ is trivial. For the converse
inclusion, let~$x \in L^{\Gal(L|E)}$. Assume for the sake of contradiction
that~$x \not\in E$. Using Zorn's lemma and the law of excluded middle, we find
a homomorphism~$\sigma : L \to L$ with~$\sigma|_E = \operatorname{id}$
and~$\sigma(x) \neq x$. This is a contradiction to~$x \in L^{\Gal(L|E)}$.}
As a consequence, the fundamental theorem of Galois theory is not provable in
constructive mathematics.

However, this failure is not for fundamental Galois-theoretic reasons, but because of an
unfortunate choice in the definitions. There is a notion of a localic group (a
locale~$G$ equipped with continuous maps~$G \times G \xrightarrow{\circ} G$, $G
\xrightarrow{(\cdot)^{-1}} G$, $1 \xrightarrow{e} G$ satisfying the group
axioms), and the topological Galois group has a localic counterpart. The
fundamental theorem can be reformulated to refer to this localic Galois group,
and the proof of this reformulation is entirely constructive.
[XXX: references]

If one is so inclined, then one can obtain the topological version of the
fundamental theorem as a corollary of the localic version; the required
non-constructive principles for this step are neatly packaged up in the study
of the relation of the localic Galois group with the topological one.

\begin{remark}Incidentally, the fundamental theorem of Galois theory also
showcases a related general phenomenon, namely that classical mathematics
allows to push back topological concerns for longer than in constructive
mathematics, whereas in constructive mathematics we have to embrace topology
(in a sufficiently pointfree form such as locales) from the beginning.

To be more specific, classically, the basic version of the fundamental theorem
(intermediate extensions correspond to subgroups) only holds for finite Galois
extensions. For infinite Galois extensions, we have to restrict to
\emph{closed} subgroups. Constructively, the basic version cannot even be shown
for finite extensions; we have to employ spatial language even for those, or
else settle for a discrete version of the fundamental theorem: For finite field
extensions, finite intermediate extensions correspond to finite subgroups.
Classically, intermediate extensions of finite extensions and subgroups of
finite groups are automatically finite, but constructively this can fail.
\end{remark}

\paragraph{Gelfand duality} XXX


\subsection{The basics of the theory of locales}

The starting point to arrive at the definition of a locale is the following
fundamental observation: The partial order~$\O(X)$ of open subsets of a topological
space~$X$ has
\[ \begin{array}{@{}ccc@{}}
\text{arbitrary joins}
&\text{and}&
\text{finite meets}, \\
\bigvee && \wedge
\end{array} \]
and finite meets distribute over arbitrary joins:
\[ U \wedge \bigvee_i V_i = \bigvee_i (U \wedge V_i). \]

This observation motivates the following definition. [XXX: which abstracts...]
\begin{definition}A \emph{frame} is a partial order with (arbitrary,
set-indexed) joins and finite meets such that the distributive law
holds. A \emph{frame homomorphism~$\alpha : A \to A'$} is a monotone map~$A
\to A'$ which preserves arbitrary joins and finite meets.\end{definition}

The least element of a frame (the empty join) is denoted~``$\bot$'' and the
largest element (the empty meet)~``$\top$''. The notion of a frame is
(infinitarily) algebraic. To obtain a geometric notion, we ``reverse the
direction of the arrows'':

\begin{definition}\label{defn:locale}
A \emph{locale}~$X$ is given by a frame~$\O(X)$, the ``frame
of opens of~$X$''. A \emph{morphism~$f : X \to X'$ of locales} (or ``continuous
map of locales'') is a frame homomorphism~$\O(X') \to \O(X)$.\end{definition}

In place of the open sets of points, locales have arbitrary \emph{opens}, the
elements of their underlying frame. The opens of locales behave similar to the
open sets in topology in that arbitrary unions and finite intersections make
sense; but unlike before, they need not be sets of points.

Examples for locales include the following.
\begin{enumerate}
\item Any topological space~$Y$ induces a locale~$L(Y)$ by
setting~$\O(L(Y)) \defeq \O(Y)$. A continuous map~$f : Y \to Y'$ of topological
spaces induces the frame homomorphism~$\O(Y') \to \O(Y),\,U \mapsto f^{-1}[U]$
in the other direction and hence a morphism~$L(Y) \to L(Y')$ of locales in the
same direction.
\item The \emph{one-point locale}~$\pt$ is the locale induced
by the one-point topological space~$\{\star\}$. Its frame of opens is
the powerset of~$\{\star\}$, also known as the set~$\Omega$ of truth
values. Its least element is~$\bot = \emptyset$ and its largest element
is~$\top = \{\star\}$, and potentially not all elements of~$\Omega$ are equal
to of these two.
\item The locale of surjections~$\NN \twoheadrightarrow \RR$ and the localic
version of the reals of Section~\ref{sect:examples-no-points} are best
constructed as \emph{classifying locales}, a notion to be introduced below.
\end{enumerate}

Several notions in topology only refer to open sets and not to points. Such
notions have an immediate counterpart in locale theory. For instance, a
locale~$X$ is \emph{compact} iff for any family~$(U_i)_{i \in I}$ of opens
of~$X$ such that~$\top = \bigvee_{i \in I} U_i$, there is a (Kuratowski-)finite
subset~$I' \subseteq I$ such that~$\top = \bigvee_{i \in I'} U_i$. For
instance, a topological space~$Y$ is compact iff its induced locale~$L(Y)$ is.

Points do not appear in the definition of a locale, but they can be defined as
a derived concept:
\begin{definition}A \emph{point} of a locale~$X$ is a locale morphism~$\pt \to
X$.\end{definition}

This definition is inspired from the situation with topological spaces, where
continuous maps from the one-point space to a topological space~$Y$ are in
canonical bijection with the points of~$Y$.

The underlying frame homomorphism~$\alpha : \O(X) \to \Omega$ of a point~$x$
of~$X$ can be pictured as mapping each open~$U$ of~$X$ to the truth value to which
extent~$x$ belongs to~$U$. Symbolically, we write~$x \inplus U$ iff~$\alpha(U)
= \top$.

The point~$x$ is completely determined by the
set~$\{ U \in \O(X) \,|\, \alpha(U) = \top \}$. This set is a \emph{completely
prime filter}, that is a subset~$\fff \subseteq \O(X)$ which is upward-closed,
closed under finite meets and for which~$\bigvee_i U_i \in \fff$ implies~$U_i
\in \fff$ for some index~$i$; and conversely, any such completely prime filter
gives rise to a point of~$X$.

\begin{definition}A locale~$X$ is \emph{spatial} if and only if its points
suffice to distinguish its opens, that is if for any opens~$U, V \in \O(X)$,
if~$x \inplus U \Rightarrow x \inplus V$ for all points~$x$ of~$X$, then~$U
\preceq V$.\end{definition}

An equivalent conditon is: if for any opens~$U, V \in \O(X)$, if~$x \inplus U
\Leftrightarrow x \inplus V$ for all points~$x$ of~$X$, then~$U = V$.

For instance, any locale induced by a topological space is spatial. The locale
of surjections~$\NN \twoheadrightarrow \RR$ is a drastic example of a locale which fails to be
spatial. The localic real line is spatial in classical mathematics and can
fail to be spatial in constructive mathematics (Theorem~\ref{thm:spatiality-reals}).

\begin{remark}The set of points of a locale~$X$ can be made into a topological space, giving
rise to a functor~$\pt : \Loc \to \Top$. This functor is right adjoint
to the functor~$L : \Top \to \Loc$. A locale~$X$ is spatial iff the canonical
morphism~$L(\pt(X)) \to X$ is an isomorphism, and a topological space~$Y$
is \emph{sober} iff the canonical morphism~$Y \to \pt(L(Y))$ is a
homeomorphism. The space~$\pt(L(Y))$ is the \emph{sobrification} of~$Y$; for
instance, the sobrification of any inhabited indiscrete space is the one-point
space.\end{remark}


\section{Sheaf models}

\subsection{Geometric theories}

\begin{definition}A \emph{geometric theory} consists of
\begin{enumerate}
  \item a set of sorts: $X$, $Y$, $Z$, \ldots
  \item a set of function symbols: $f : X \times Y \to Z$, \ldots
  \item a set of relation symbols: $R \hookrightarrow X \times Y \times Z$, \ldots
  \item a set of geometric sequents as axioms: $\varphi \vdash_{x:X, y:Y} \psi$, \ldots
\end{enumerate}
A \emph{geometric sequent} (in some context~$x_1\?X_1,\ldots,x_n\?X_n$) is a
formula built using only the ingredients ${=}\ {\top}\ {\wedge}\ {\bot}\
{\vee}\ {\bigvee}\ {\exists}$ and the relation symbols (but no ${\Rightarrow}\
{\forall}$). The symbol~``$\bigvee$'' refers to disjunctions of arbitrary
set-indexed families of formulas.
\end{definition}

Even though superficially similar, geometric theories play a
substantially different role than formal systems such as Peano arithmetic or
Zermelo--Fraenkel set theory. There are a number of notable differences:
\begin{enumerate}
\item Formal systems are typically of foundational interest and can be
fruitfully employed as metatheories. Geometric theories are more interesting
for applications, for instance for presenting spaces. This aspect is discussed
in Section~\ref{sect:presenting-frames}.
\item Formal systems typically come with an intended model; geometric theories
do not. For instance, the geometric theory of groups has all groups as models;
when we are writing down the axioms of a group, we are not setting out to
capture the properties of any one specific group.
\item Formal systems are typically required to be recursively
axiomatizable. Many interesting geometric theories are not, and indeed contain
an uncountable number of axioms. Geometric theories also allow for arbitrary
set-indexed disjunctions; for this to make sense, the study of geometric
theories can only be carried out in a sufficiently rich background theory.
\item For formal systems, typically a version of Gödel's completeness theorem
holds: A formula is derivable iff it holds in all models. In contrast,
geometric theories can be consistent yet do not admit set-based models. An
example is the geometric theory of surjections~$\NN \twoheadrightarrow \RR$
reviewed below.
\item Perhaps the most important difference to formal systems is that geometric
theories often depend on given mathematical objects. For instance, for each
ring~$A$, there is the geometric theory of prime ideals of~$A$.
\end{enumerate}

\begin{definition}A \emph{set-based model}~$M$ (or ``Tarski model'') of a
geometric theory~$\TT$ consists of
\begin{enumerate}
  \item a set~$\brak{X}$ for each sort~$X$,
  \item a function~$\brak{f} : \brak{X_1} \times \cdots \times \brak{X_n} \to
  \brak{Y}$
  for each function symbol~$f : X_1 \times \cdots \times X_n \to Y$ and
  \item a relation~$\brak{R} \subseteq \brak{X_1} \times \cdots \times \brak{X_n}$
  for each relation symbol~$R \hookrightarrow X_1 \times \cdots \times X_n$
\end{enumerate}
such that~$M$ validates the axioms of~$\TT$.
\end{definition}

\paragraph{The geometric theory of rings.} This theory has one sort, $R$; five function symbols:
$0$ and $1$ (nullary), $-$ (unary), $+$ and $\cdot$ (binary); no relation
symbols; the usual axioms, such as $\top \vdash_{x:R,y:R} x + y = y + x$.

A set-based model of the theory of rings is an ordinary ring.

In a similar vein, there is the geometric theory of monoids, of groups, and so
on.

\paragraph{The geometric theory of objects.} This theory has one sort, $X$, and no function
symbols, relation symbols or axioms. A set-based model of this theory is just a
set.

A variant of this theory is the theory of inhabited objects, which has the
axiom~$\top \vdash \exists x\?X\_ \top$. Its set-based models are precisely the
inhabited sets.

\paragraph{The geometric theory of surjections~$f : \NN \twoheadrightarrow
\RR$.} This theory has no
sorts; no function symbols; a nullary relation symbol~$\varphi_{nx}$ for each
pair~$\langle n,x \rangle \in \NN \times \RR$ (to be read as~``$f$ maps~$n$
to~$x$''); and the following axioms:
\begin{enumerate}
\item For each~$n \in \NN$, the axiom~$\top \vdash \bigvee_{x \in \RR}
\varphi_{nx}$, expressing that~$f$ is total.
\item For each~$n \in \NN$ and each~$x,y \in \RR$, the axiom~$\varphi_{nx}
\wedge \varphi_{ny} \vdash \bigvee\{ \top \,|\, x = y \}$,
expressing that~$f$ is single-valued.\footnote{The disjunction is taken over
the set~$\{ \top \,|\, x = y \}$. This is a certain subsingleton set of
formulas; it is inhabited (by the formula~$\top$) iff~$x = y$. Hence, if~$x =
y$, this axiom reads~$\varphi_{nx}
\wedge \varphi_{ny} \vdash \top$ and could also be omitted; if~$x \neq y$,
this axiom reads~$\varphi_{nx} \wedge \varphi_{ny} \vdash \bot$.}
\item For each~$x \in \RR$, the axiom~$\top \vdash \bigvee_{n \in \NN}
\varphi_{nx}$, expressing that~$f$ is surjective.
\end{enumerate}

A model of this geometric theory consists of an~$(\NN \times \RR)$-indexed
family of truth values, that is a subset~$G$ of~$\NN \times \RR$, satisfying
precisely those axioms which render~$G$ the graph of a surjection~$\NN
\twoheadrightarrow \RR$.

\paragraph{The geometric theory of Dedekind cuts.} This theory has no sorts; no
function symbols; nullary relation symbols~$\alpha_x$ and~$\beta_x$ for each
rational number~$x$ (to be read as~``$x$ is contained in the lower respectively
the upper cut''); and the following axioms, spelling out that the cut is bounded,
rounded, open and located:
\begin{align*}
  \top &\vdash \textstyle\bigvee_{x \in \QQ} \alpha_x \\
  \top &\vdash \textstyle\bigvee_{x \in \QQ} \beta_x \\
  \alpha_y &\vdash \alpha_x & \text{(for each~$x,y \in \QQ$ such that~$x < y$)} \\
  \beta_x &\vdash \beta_y & \text{(for each~$x,y \in \QQ$ such that~$x < y$)} \\
  \alpha_x &\vdash \textstyle\bigvee_{y > x} \alpha_y & \text{(for each~$x \in \QQ$)} \\
  \beta_y &\vdash \textstyle\bigvee_{x < y} \beta_x & \text{(for each~$y \in \QQ$)} \\
  \alpha_x \wedge \beta_y &\vdash \bot & \text{(for each~$x,y \in \QQ$ such that~$x \geq y$)} \\
  \top &\vdash \alpha_x \vee \beta_y & \text{(for each~$x,y \in \QQ$ such that~$x < y$)}
\end{align*}

A model of this geometric theory consists of two families of truth values, both
indexed by the rational numbers, hence two subsets~$L,U \subseteq \QQ$, in such
a way that~$\langle L,U \rangle$ is a Dedekind cut.

\paragraph{The geometric theory of prime ideals of a given ring~$A$.} In classical
commutative algebra, the notion of a \emph{prime ideal} of a ring~$A$ is
fundamental. Corresponding to the definition (recalled in
Section~\ref{sect:algebraic-preliminaries}), the geometric theory of prime
ideals has no sorts; no function
symbols; one relation symbol~$\alpha_x$ for each element~$x \in A$; and the
following axioms:
\begin{align*}
  \top &\vdash \alpha_0 \\
  \alpha_x \wedge \alpha_y &\vdash \alpha_{x+y} & \text{(for each~$x,y \in A$)} \\
  \alpha_x &\vdash \alpha_{rx} & \text{(for each~$r,x \in A$)} \\
  \alpha_1 &\vdash \bot \\
  \alpha_{xy} &\vdash \alpha_x \vee \alpha_y & \text{(for each~$x,y \in A$)}
\end{align*}

For many purposes, the theory of prime \emph{filters} is actually more
relevant. Classically, a prime filter of a ring is simply the complement of a
prime ideal; constructively, it is prudent to axiomatize this notion directly.
Hence the theory of prime filters of~$A$ has no sorts, no function symbols, one
relation symbol~$\alpha_x$ for each element~$x \in A$ and the following
axioms:
\begin{align*}
  \alpha_0 &\vdash \bot \\
  \alpha_{x+y} &\vdash \alpha_x \vee \alpha_y & \text{(for each~$x,y \in A$)} \\
  \alpha_{rx} &\vdash \alpha_x & \text{(for each~$r,x \in A$)} \\
  \top &\vdash \alpha_1 \\
  \alpha_x \wedge \alpha_y &\vdash \alpha_{xy} & \text{(for each~$x,y \in A$)}
\end{align*}

\paragraph{The inconsistent geometric theory.} This theory has no sorts,
function symbols or relations, but the single axiom $\top \vdash \bot$.
This theory does not admit any set-based models.

\paragraph{The empty geometric theory.} This theory does not have any sorts,
function symbols, relations or axioms. There is exactly one set-based model of
this theory, the empty structure.


\subsection{Presenting frames by theories}
\label{sect:presenting-frames}

\begin{definition}A geometric theory~$\TT$ is \emph{propositional} if and only
if its set of sorts is empty.\end{definition}

As a consequence, a propositional geometric theory consists just of a set of
nullary relation symbols and a set of axioms. Associated to any such
theory~$\TT$ is its \emph{Lindenbaum algebra}: This is the partially ordered
set of the formulas over the signature of~$\TT$ modulo~$\TT$-provable
equivalence, equipped with the ordering~$[\varphi] \preceq [\psi]$ iff~$\TT$
proves~$\varphi \vdash \psi$.

The Lindenbaum algebra is a frame, with finite meets given by~$[\varphi] \wedge
[\psi] = [\varphi \wedge \psi]$ and set-indexed joins given by~$\bigvee_i
[\varphi_i] = [\bigvee_i \varphi_i]$;\footnote{This short description of the
set-indexed joins picks representatives from each equivalence class and is
hence only sensible in the presence of the axiom of choice. In a
constructive metatheory, we should rather write~$\bigvee_{i \in I} M_i =
[\bigvee_{\varphi \in K} \varphi]$, where~$K = \{ \varphi \,|\, \exists i \in
I\_ \varphi \in M_i \}$.} we can regard the Lindenbaum algebra as the free
frame generated by the nullary relation symbols of~$\TT$ modulo the axioms
of~$\TT$. Our interest in the Lindenbaum algebra is because it gives rise to a
locale:

\begin{definition}The \emph{classifying locale}~$L(\TT)$ of a propositional
geometric theory is the locale which has the Lindenbaum algebra of~$\TT$ as its
underlying frame.\end{definition}

It is an instructive exercise to verify that the points of~$L(\TT)$ are in
canonical one-to-one correspondence with the set-based models of~$\TT$. This
observation also explains why we cannot hope to construct classifying
locales of arbitrary, nonpropositional, geometric theories: Any locale only has
a set of points, but arbitrary geometric theories can have a proper class of
set-based models.

Many locales are fruitfully described as the classifying locale of a certain
propositional geometric theory. For instance:
\begin{enumerate}
\item The \emph{localic real line} is the classifying locale of the theory of
Dedekind cuts. Its points are the models of that theory, that is, the Dedekind
reals, and the induced topology on the set of points coincides with the usual
Euclidean topology on the reals.

The localic open unit interval is the classifying locale of the
same theory, but with the added axiom~$\top \vdash \alpha_0 \wedge \beta_1$.
\item The \emph{locale of surjections~$\NN \twoheadrightarrow \RR$} is the
classifying locale of the theory of surjections~$\NN \twoheadrightarrow \RR$.
\item The \emph{spectrum} of a ring~$A$ is the classifying locale of the
theory of prime filters of~$A$. The topological space of points of this locale
is the Zariski spectrum as familiar from algebraic
geometry.\footnote{Classicaly, the spectrum is usually defined as the
topological space of prime ideals instead of prime filters. However,
classically there is a canonical one-to-one correspondence between prime ideals
and prime filters, hence one could just as well use filters instead of ideals
in the definition. The classifying locale of prime ideals of~$A$ also exists,
and has the prime ideals of~$A$ as its points, but the induced topology on its
topological space of points is the \emph{flat topology} or \emph{co-Zariski
topology}~\cite{tarizadeh:flat} instead of the ordinary
Zariski topology~\cite[Proposition~4.5]{johnstone:rings-fields-and-spectra}.}
\item The \emph{localic Galois group} of a field extension~$L|k$ is the
classifying locale of the theory of ring automorphisms~$L \to L$ which fix~$k$.
\item The \emph{empty locale} is the classifying locale of the inconsistent theory.
\item The \emph{one-point locale} is the classifying locale of the empty theory.
%\item The \emph{discrete locale on a set~$M$} is the classifying locale of the
%theory which has one nullary relation symbol~$\varphi_x$ for each element~$x
%\in M$, the axiom~$\top \vdash \bigvee_{x \in M} \varphi_x$ and for each~$x,y
%\in M$ the axiom~$\varphi_x \wedge \varphi_y \vdash \bigvee\{ \top \,|\, x = y
%\}$.
\end{enumerate}

Just as we often refer to a topological space only by its points (``the
topological space of prime filters of~$A$''), not mentioning its topology, it is
customary to abbreviate ``the classifying locale of the propositional geometric
theory of prime filters of~$A$'' as ``the locale of prime filters of~$A$''.

\begin{remark}The traditional way of constructing the real line or the Zariski
spectrum as a topological space proceeds in three steps: (1) Write down the
axioms (of Dedekind cuts respectively prime filters). (2) Using the powerset
axiom and separation, construct the set of Dedekind reals respectively the set
of prime filters. (3) Devise a useful topology on the resulting set.

Locales provide us with a more economic and also more conceptual way of
arriving at these topological spaces: They can be obtained as the topological
space of points of the corresponding classifying locale. In particular,
step~(3) of manually devising a topology is not necessary when pursuing the
localic route.
\end{remark}

In general, different theories can give rise to isomorphic classifying locales;
such theories are called \emph{Morita-equivalent}. A vast research program is
built on this observation~\cite{caramello:tst}.

Conversely, any locale~$X$ is the classifying locale of a certain theory, namely
of the \emph{theory of points of~$X$}. This theory has one nullary relation
symbol~$\varphi_U$ for each open~$U \in \O(X)$ (read as ``the point belongs
to~$U$'') and the following axioms:
\begin{align*}
  \varphi_U &\vdash \varphi_V & \text{(for all~$U,V \in \O(X)$ such that~$U \preceq V$)} \\
  \top &\vdash \varphi_\top \\
  \varphi_U \wedge \varphi_V &\vdash \varphi_{U \wedge V} & \text{(for all~$U,V \in \O(X)$)} \\
  \varphi_{\bigvee_i U_i} &\vdash \bigvee_i \varphi_{U_i} & \text{(for each set-indexed family~$(U_i)_i$ of opens)}
\end{align*}
These are exactly the axioms for a completely prime filter of~$\O(X)$. The
isomorphism from~$\O(X)$ to the Lindenbaum algebra of this theory maps an
open~$U$ to~$[\varphi_U]$.

The question whether a given locale is spatial is intimately related with the
existence of appropriate \emph{ideal objects}. Their existence typically hinges
on the axiom of choice or some of its variants. For instance, there are the
following results (where we allow ourselves a modicum in classical logic in
order to state the results in a familiar form).
\begin{enumerate}
\item The localic spectrum of a ring~$A$ is spatial iff every nontrivial ideal
(of a certain class of rings related with~$A$) is contained in a prime ideal.
\item The localic Galois group of a Galois extension~$L|k$ is spatial iff
any~$k$-homomorphism~$\sigma : E \to L$ defined on a finite intermediate
extension~$L|E|k$ can be extended to a~$k$-homomorphism~$L \to L$.
\item The localic real line is spatial iff the every open covering of the
set~$[0,1]$ of Dedekind reals has a Lebesgue number (that is, is Heine--Borel
compact).
\item The statement that any classifying locale of a propositional coherent
theory (that is, a propositional geometric theory in which only finite
disjunctions occur) is spatial is equivalent to the Boolean Prime Ideal
Theorem~\BPIT.
\end{enumerate}
These results explain why in classical mathematics, where all of these
conditions are satisfied, we can blithely and fruitfully use the topological
spectrum of a ring, the topological Galois group or the topological space of
reals. In classical mathematics, employing the localic counterparts is merely
for convenience or for aesthetic reasons; in constructive mathematics, the
localic replacements (or similar replacements in other pointfree approaches to
topology) are vital.

%\begin{theorem}The localic real line is spatial if and only if the set~$[0,1]$ of
%Dedekind real numbers is compact in the sense of Heine--Borel.
%\end{theorem}
%
%\begin{proof}XXX\end{proof}

%\begin{theorem}Let~$A$ be a ring and~$\Spec(A)$ its spectrum as defined above as the locale of
%prime filters of~$A$. Then~$\Spec(A)$ is spatial if (the law of excluded middle and) the
%Boolean Prime Ideal Theorem~\BPIT hold. More specifically, $\Spec(A)$ is
%spatial if and only if for any ideal~$\aaa \subseteq A$ and any element~$x \in A$,
%\[ x \in \sqrt{\aaa} \quad\textnormal{if}\quad
%\textnormal{for all filters~$\fff \subseteq A$ with~$x \in \fff$, $\fff \between \aaa$}. \]
%\end{theorem}
%
%The symbol~``$\between$'' denotes that the two sets have an element in common.
%
%\begin{proof}Assume that~$\Spec(A)$ is spatial. Let an ideal~$\aaa \subseteq A$
%and an element~$x \in A$ be given such that for all filters~$\fff \subseteq A$
%with~$x \in \fff$, $\fff \between \aaa$. Then for all filters~$\fff$, $\fff
%\inplus \alpha_x \Rightarrow \fff \inplus \bigvee_{y\in \aaa} \alpha_y$.
%Hence ...
%Using the filter axioms, any open of~$\Spec(A)$ can be written
%as~$[\bigvee_i \alpha_{x_i}]$.
%\end{proof}


\subsection{Sheaves on locales}

\begin{definition}\label{defn:presheaf}
A \emph{presheaf}~$F$ on a locale~$X$ is a functor~$\O(X)^\op
\to \Set$, that is
\begin{enumerate}
  \item a set~$F(U)$ for each open~$U \in \O(X)$ and
  \item a map~$(\cdot)|^U_V : F(U) \to F(V)$ for each pair of opens~$V \preceq U$
\end{enumerate}
such that $(\cdot)|^U_U = \operatorname{id}_{F(U)}$ for all~$U \in \O(X)$ and
$(\cdot)|^V_W \circ (\cdot)|^U_V = (\cdot)|^U_W$ for all~$W \preceq V
\preceq U$.\end{definition}

Definition~\ref{defn:presheaf}, as well as any other definition in this section,
also makes sense for topological spaces instead of locales, since only the
notion of opens and their inclusion relation is used. The elements of~$F(U)$ are
called \emph{sections of~$F$ over~$U$} and the maps~$(\cdot)|^U_V$
are called \emph{restriction maps}.

When first learning about presheaves, one can get boggled down[XXX:wording] by the vast
amount of data encoded in a single presheaf (one set for each open). The
situation should be compared to Kripke models for a first-order language~$L$. The
preorder~$W$ of nodes of such a model is like the frame of opens of a locale, and the
family~$(M_w)_{w \in W}$ of~$L$-structures, one for each node, is like a
presheaf. In fact, the notion of a locale can be generalized to that of a
\emph{site} so that both locales and Kripke frames induce sites and that
presheaves on sites can be defined; however, this shall not be pursued here.
[XXX: reference]

The prototypical example of a presheaf (and also a sheaf) is the presheaf~$\C$ of
continuous real-valued functions on a space~$X$. For this presheaf, the
set~$\C(U)$ is the set of continuous real-valued maps~$U \to \RR$, and the
maps~$(\cdot)|^U_V$ are given by actual restriction of functions to smaller
domains, that is by
\[ \C(U) \longrightarrow \C(V),\ s \longmapsto s|_V. \]

\begin{definition}
\begin{enumerate}
\item A \emph{compatible family} of a presheaf~$F$ with respect to an open
covering~$U = \bigvee_i U_i$ is a family~$(s_i)_i$ of sections~$s_i \in F(U_i)$
such that~$s_i|^{U_i}_{U_i \wedge U_j} = s_j|^{U_j}_{U_i \wedge U_j}$ for all
indices~$i,j$.
\item A presheaf~$F$ is a \emph{sheaf}
iff for any compatible family~$(s_i)_i$ with respect to an open covering~$U =
\bigvee_i U_i$ there is a unique section~$s \in F(U)$ such
that~$s|^U_{U_i} = s_i$ for all~$i$.
\end{enumerate}
\end{definition}

For instance, the presheaf~$\C$ of continuous real-valued functions is a sheaf,
while its subpresheaf~$\C_\text{c}$ of constant real-valued functions is
usually not a sheaf. For instance, on~$X = \RR$, the two constant functions~$f
: (-1,0) \to \RR,\,x \mapsto -1$ and~$g : (0,1) \to \RR,\,x \mapsto 1$ agree on
the intersection of their domains (which is empty), but there is no constant
function~$h : (-1,0) \cup (0,1) \to \RR$ which restricts to~$f$ on~$(-1,0)$ and
to~$g$ on~$(0,1)$.

\begin{definition}A \emph{morphism of presheaves}~$\eta : F \to G$ on a
locale~$X$ is a family~$(\eta_U)_{U \in \O(X)}$ of maps~$\eta_U : F(U) \to
G(U)$ such that for all sections~$s \in F(U)$ and all opens~$V \preceq U$
of~$X$, $\eta_U(s)|^U_V = \eta_V(s|^U_V)$. A \emph{morphism of sheaves} is a
morphism of the underlying presheaves.
\end{definition}


\subsection{Sheaf semantics}

Let~$X$ be a locale. A \emph{formula over an open~$U \in \O(X)$} is a
first-order formula (made up using~${=}\ {\top}\ {\wedge}\ {\bot}\ {\vee}\
{\Rightarrow}\ {\forall}\ {\exists}$) over the signature which has one sort for
each sheaf~$F$, one constant symbol of sort~$F$ for each section~$s \in F(U)$,
one function symbol~$f : F \to G$ for each morphism of sheaves, and so on.

Table~\ref{table:sheaf-semantics} defines by recursion on the structure of
formulas what it means for a formula~$\varphi$ over an open~$U$ to be
\emph{forced} or \emph{true over~$U$}, written~``$U \models \varphi$''. The
main differences with the perhaps more familiar Kripke semantics are marked.

\begin{table}[ht]
  \tbl{The (first-order fragment of) the sheaf semantics of a locale~$X$}{\begin{tabular}{@{}l@{\ \ }c@{\ \ }l@{}}
    $U \models s =_F t$ &\Ll& $s = t$ when evaluated as elements of~$F(U)$ \\
    $U \models \top$ &\Ll& true \\
    $U \models \varphi \wedge \psi$ &\Ll& $U \models \varphi$ and $U \models \psi$ \\
    $U \models \bot$ &\Ll& \hcancel{false}{0pt}{3pt}{0pt}{-2pt}\ $U = \bot$ \\
    $U \models \varphi \vee \psi$ &\Ll& \hcancel{$U \models \varphi$ or $U \models \psi$}{0pt}{3pt}{0pt}{-2pt}\ there exists an open covering $U = \bigvee_i U_i$ \\
    && \quad\quad such that for all~$i$: $U_i \models \varphi$ or $U_i \models \psi$ \\
    $U \models \varphi \Rightarrow \psi$ &\Ll& for all~$V \preceq U$: $V \models \varphi$ implies $V \models \psi$ \\
    $U \models \forall s \? F\_ \varphi(s)$ &\Ll& for all $V \preceq U$ and sections~$s_0 \in F(V)$: $V \models \varphi(s_0)$ \\
    $U \models \exists s \? F\_ \varphi(s)$ &\Ll& \hcancel{there exists $s_0 \in F(U)$ such that $U \models \varphi(s_0)$}{0pt}{3pt}{0pt}{-2pt} \\
    && there exists an open covering $U = \bigvee_i U_i$ such that for all~$i$: \\
    && \quad\quad there exists~$s_0 \in F(U_i)$ such that $U_i \models \varphi(s_0)$
  \end{tabular}}
  \label{table:sheaf-semantics}
\end{table}

Some clauses in Table~\ref{table:sheaf-semantics} contain slight abuses of
notation. Namely, if~$\varphi$ is a formula over an open~$U$ and if~$V$ is an
open such that~$V \preceq U$, then~``$V \models \varphi$'' is officially not
well-defined, as~$\varphi$ is not a formula over~$V$. When we still write~``$V
\models \varphi$'', we mean that any constant symbol~$s \in F(U)$ appearing
in~$\varphi$ should be interpreted as its restriction~$s|^U_V \in F(V)$, so
that the resulting formula is a formula over~$V$.

The principal properties of the sheaf semantics is that it is monotone, local
and sound with respect to intuitionistic first-order logic:

\begin{theorem}Let~$X$ be a locale. Let~$U$ be an open of~$X$. Let~$\varphi$ be
a formula over~$U$.
\begin{enumerate}
\item If~$V$ is an open such that~$V \preceq U$, then~$U \models
\varphi$ implies~$V \models \varphi$.
\item Let~$U = \bigvee_i U_i$ be an open covering. If~$U_i \models
\varphi$ for all~$i$, then~$U \models \varphi$.
\item Let~$\psi$ be a further formula over~$U$. If~$U \models
\varphi$ and if~$\varphi$ entails~$\psi$ intuitionistically, then also~$U
\models \psi$.
\end{enumerate}
\end{theorem}

\begin{proof}The proof of~(1) is by a routine induction on the structure
of~$\varphi$. For the clauses pertaining disjunction and existential
quantification, the distributive law has to be used.

The proof of~(2) is also a routine induction proof. For the clause pertaining
equality, the sheaf condition has to be used.

To verify statement~(3), it is prudent to generalize the claim slightly: An
induction on the structure of derivations shows that if a sequent~$\varphi
\seq{x_1{:}X_1,\ldots,x_n{:}X_n} \psi$ is derivable in intuitionistic first-order
logic, then~$U \models \forall x_1\?X_1\_ \ldots \forall x_n\?X_n\_ (\varphi
\Rightarrow \psi)$.
\end{proof}

\begin{definition}A \emph{sheaf model}~$M$ of a geometric theory~$\TT$ over a
locale~$X$ consists of
\begin{enumerate}
  \item a sheaf~$\brak{S}$ on~$X$ for each sort~$S$,
  \item a morphism~$\brak{f} : \brak{S_1} \times \cdots \times \brak{S_n} \to
  \brak{T}$ of sheaves for each function symbol~$f : S_1 \times \cdots \times S_n \to T$ and
  \item a subsheaf~$\brak{R} \subseteq \brak{S_1} \times \cdots \times \brak{S_n}$
  for each relation symbol~$R \hookrightarrow S_1 \times \cdots \times S_n$
\end{enumerate}
such that~$M$ validates the axioms of~$\TT$, that is, such that the axioms
of~$\TT$ are forced on~$\top \in \O(X)$.
\end{definition}

XXX ``internalizing parameter-dependence''


\section{Applications in constructive algebra}

Commutative algebra abounds with techniques to reduce given situations to
simpler ones, for instance passing to a quotient or passing to a
localization. These techniques facilitate short and elegant proofs, such as the
following. (Section~\ref{sect:algebraic-preliminaries} contains some algebraic
preliminaries.)

\begin{quote}
\textbf{Theorem.} Let~$M$ be an injective matrix with more columns than rows
over a reduced ring~$A$. Then~$1 = 0$ in~$A$.

\textbf{Proof.} \uwave{Assume not.} Then there is a \uwave{minimal
prime ideal} $\ppp \subseteq A$. The matrix~$M$ is also injective when
considered as a matrix over the stalk~$A_\ppp$; since~$A_\ppp$ is a
\uwave{field}, this is a contradiction to basic linear algebra. \qed
\end{quote}

However, these reduction techniques typically require \emph{transfinite
methods}. The displayed proof contains three appeals to the transfinite:
\begin{enumerate}
\item The proof proceeds by contradiction, hence requires the law of excluded
middle, the strongest of the omniscience principles.
\item The proof then requires a minimal prime ideal. Such an ideal can be
obtained in two steps: First, the Boolean Prime Ideal
Theorem~\BPIT is invoked to obtain some prime ideal. Then
Zorn's lemma fabricates a minimal one.\footnote{Standard textbooks prove the statement ``any nontrivial
ring has a prime ideal'' by using Zorn's lemma, which
in the presence of the law of excluded middle is equivalent to the full axiom
of choice; however, the statement is actually equivalent to the weaker Boolean
Prime Ideal Theorem [XXX: reference].

The combined statement ``any ring has a minimal prime ideal'' is equivalent to
the full axiom of choice. This observation might be folklore; we learned the
following argument from Will Savin~[XXX: reference]: Let~$(M_i)_{i \in I}$ be a
disjoint family of inhabited sets. We consider the free ring~$\ZZ[\bigcup_i M_i]$ and
its ideal~$I$ generated by~$\{ ab \,|\, i \in I, a,b \in M_i, a \neq b \}$. Assume
that the factor ring~$\ZZ[\bigcup_i M_i]/I$ contains a minimal prime ideal. Its
preimage~$\ppp \subseteq \ZZ[\bigcup_i M_i]$ is then a prime ideal which is
minimal among all prime ideals containing~$I$. By primality, for any index~$i$,
there is at most one element of~$M_i$ not in~$\ppp$. By minimality, for each
index~$i$, there is exactly one element of~$M_i$ not in~$\ppp$: If there were
none, then pick an element~$a \in M_i$ XXX}
% https://mathoverflow.net/questions/98731/minimal-prime-ideals-and-axiom-of-choicerevised-version
\item Finally, the proof exploits that the stalks of reduced rings at minimal
prime ideals are fields. This requires two further invokations
of~\BPIT.\footnote{By~\BPIT, the intersection of all prime ideals of~$A_\ppp$
is its nilradical. Since~$A_\ppp$ is reduced, the nilradical is the zero ideal.
Since the prime ideals of~$A_\ppp$ are in bijection with those prime ideals
of~$A$ which are contained in~$\ppp$, the ring~$A_\ppp$ has exactly one prime
ideal. By~\BPIT, any noninvertible element of~$A_\ppp$ is contained in some
prime ideal, hence in the zero ideal. Thus~$A_\ppp$ is a field.}
\end{enumerate}

This state of affairs is not satisfactory. A statement as simple as the
displayed example should admit an explicit calculational proof, presenting a
concrete method for transforming the given conditional equations expressing
injectivity into the equation~$1 = 0$ without any appeals to the transfinite.

The completeness theorem for coherent logic~[XXX: reference (Elephant)] even
gives an a priori reason why (for a given matrix size) a finitary proof has to
exist. However, since the proof of the completeness theorem itself uses~\BPIT
(and indeed is equivalent to it), it does not give any indication how such a
proof could be found. (Still, beautiful constructive proofs are known and
presented, for instance, in a celebrated short note by Richman on nontrivial
uses of trivial rings~\cite{richman:trivial-rings} and in the recent textbook by
Lombardi and Quitté on constructive commutative
algebra~\cite{lombardi-quitte:constructive-commutative-algebra}.)

The key issue with the usual reduction techniques in commutative algebra is
their dependence on \emph{ideal objects} such as prime or maximal ideals. In
general, those objects can only be obtained by transfinite methods. However, in
practice many arguments do not actually require completed ideal objects:
Their computational core applies just as well to finite approximations of
these ideal objects.

It is then a challenging task in mathematical logic to devise efficient means to
extract this hidden constructive content in a mostly mechanical manner. We
envision to reinterpret any given classical proof employing ideal objects in a
constructive fashion, realizing ideal objects as convenient fictions.

Locales and sheaf models contribute to this program by providing new reduction
techniques for commutative algebra. These techniques have a similar effect as the
classical reduction techniques, but are powered by purely constructive
underpinnings. In a nutshell, the idea is as follows.

\begin{enumerate}
\item Instead of replacing a given ring with another (for instance a ring~$A$ with
one of its stalks~$A_\ppp$ at a minimal prime ideal), we replace a given ring
with a \emph{sheaf of rings}.
\item We then maintain the illusion that we are working with a plain old ring
by employing the sheaf semantics.
\end{enumerate}

The goal of this section is to give a leisurely introduction to this procedure.
We recall in Section~\ref{sect:algebraic-preliminaries} algebraic
preliminaries. Section~\ref{sect:a-remarkable-sheaf} explores the sheaf to use.
There is an interesting origin story to this sheaf, which we tell in
Section~\ref{sect:origins}. Finally, we illustrate how to use the technique in
a series of concrete examples in Section~\ref{sect:example-applications}.


\subsection{Algebraic preliminaries}
\label{sect:algebraic-preliminaries}

By \emph{ring}, we mean commutative ring with unit. We do not require the unit
to be distinct from the zero; indeed, trivial rings have intriguing
applications~\cite{richman:trivial-rings}.

A ring is \emph{reduced} iff zero is its only nilpotent; that is, if~$x^n = 0$
implies~$x = 0$.

An \emph{ideal} is a subset~$\aaa \subseteq A$ such that~$0 \in \aaa$, $(x \in
\ppp) \wedge (y \in \ppp) \Rightarrow (x + y \in \ppp)$ and $(x \in
\ppp) \Rightarrow (rx \in \ppp)$ (for any~$r \in A$).
An ideal~$\ppp$ is \emph{prime} iff~$1 \not\in \ppp$ and~$(xy
\in \ppp) \Rightarrow (x \in \ppp) \vee (y \in \ppp)$.

A \emph{minimal prime ideal} is a prime ideal~$\ppp$ such that for any prime
ideal~$\qqq$ with~$\qqq \subseteq \ppp$, $\qqq = \ppp$.

A subset~$\fff \subseteq A$ is a \emph{prime filter} iff
$0 \not\in \fff$, $(x + y \in \fff) \Rightarrow (x \in \fff) \vee (y \in
\fff)$, $1 \in \fff$ and $(xy \in \fff) \Leftrightarrow (x \in \fff) \wedge (y
\in \fff)$.

An ideal~$\aaa \subseteq A$ is a \emph{radical ideal} iff~$x^n \in \aaa$
implies~$x \in \aaa$ for any~$x \in A$ and natural number~$n$. The
\emph{radical}~$\sqrt{\aaa}$ of an arbitrary ideal~$\aaa$ is the radical
ideal~$\{ x \in A \,|\, \exists n \in \NN\_ x^n \in \aaa \}$.

A ring is \emph{local} iff a finite sum is invertible only if one of its
summands also is. More precisely, this means that~$1 \neq 0$ and that
whenever~$a + b$ is invertible, $a$ is invertible or~$b$ is invertible.
This definition is an elementary rephrasing of the textbook definition,
according to which a ring is local iff it has exactly one maximal ideal. The
elementary definition works better in constructive contexts.

If~$S$ is a multiplicatively closed subset of a ring~$A$, the
\emph{localization}~$A[S^{-1}]$ is the ring of formal fractions~$\frac{a}{s}$ with~$a
\in A$ and~$s \in S$, where two such fractions~$\frac{a}{s}$ and~$\frac{b}{t}$ are deemed
equivalent iff there is an element~$u \in S$ such that~$uta = usb$. We do not
require that~$0 \not\in S$; instead we plainly observe that ~$A[S^{-1}]$ is the
zero ring iff~$0 \in S$.

An important special case is \emph{localizing away from an element}: If~$f$ is
an element of~$A$, then~$A[f^{-1}]$ is~$A[\{1,f,f^2,f^3,\ldots\}^{-1}]$. This
ring is the zero ring iff~$f$ is nilpotent.

The \emph{stalk at a prime ideal}~$\ppp \subseteq A$ is the
localization~$A_\ppp \defeq A[(A \setminus \ppp)^{-1}]$. Assuming de Morgan's
laws, such stalks are local rings. The \emph{stalk at a filter}~$\fff \subseteq A$ is
defined as~$A_\fff \defeq A[\fff^{-1}]$ and is a local ring even
constructively. Conversely, if a localization~$A[S^{-1}]$ is local then~$S$ can
be saturated to a filter.

A property of rings is \emph{localization-stable} iff it is inherited by any
localization. For instance, if~$A$ is a reduced ring, then so is any
localization~$A[S^{-1}]$.


\subsection{A remarkable sheaf}
\label{sect:a-remarkable-sheaf}

Let~$A$ be a ring. Then there is a certain locale~$X$ which contains a
certain ``mirror image'' of~$A$, a sheaf~$A^\sim$ of rings. On the one hand,
this mirror image is ``close to~$A$'', such that studying~$A^\sim$ pays off for
learning about~$A$. On the other hand, it has much better properties than~$A$
has.

\begin{center}
\vbox{$A^\sim$ is close to~$A$: \\[0.6em]
\framebox{\parbox{0.9\textwidth}{\vspace*{-0.7em}
\begin{Alphlist}[(C)]
\item\label{item:iso}
There is a canonical isomorphism~$A \to A^\sim(X)$ of rings.
\item\label{item:loc-stable}
$A^\sim$ inherits any property of~$A$ which is
localization-stable.
\item\label{item:stalks}
A geometric sequent holds for~$A^\sim$ iff$^\star$ it holds for all
stalks~$A_{\mathfrak{f}}$.
\end{Alphlist}\vspace*{-0.7em}}}}
\hfill $^\star$assuming \BPIT for the ``if'' direction{\quad}
\bigskip

\vbox{$A^\sim$ has better properties than~$A$: \\[0.6em]
\framebox{\parbox{0.9\textwidth}{\vspace*{-0.7em}
\begin{Alphlist}[(D)]
\addtocounter{enumi}{3}
\item\label{item:local} $A^\sim$ is a local ring.
\end{Alphlist}

Assuming that~$A$ is reduced: \\[-1.8em]
\begin{Alphlist}[(G)]
\addtocounter{enumi}{4}
\item\label{item:field} $A^\sim$ is a field: $\forall x\?A^\sim\_ (\neg(\exists y\?A^\sim\_ xy = 1) \Rightarrow x = 0)$.
\item\label{item:negneg-stable} $A^\sim$ has $\neg\neg$-stable equality:
$\forall x,y\?A^\sim\_ \neg\neg(x = y) \Rightarrow x = y$.
\item\label{item:noetherian} $A^\sim$ is \emph{anonymously Noetherian}.
\end{Alphlist}\vspace*{-0.7em}}}}
\end{center}

Recall that when we ascribe some ring-theoretic property to~$A^\sim$, we
are implicitly using the sheaf semantics. For instance, when we say
that~$A^\sim$ is a local ring, we actually mean
\begin{multline*}
  \Sh(X) \models \neg(1 =_{A^\sim} 0) \quad\text{and} \\
  \Sh(X) \models \forall x,y\?A^\sim\_ \bigl(x + y =_{A^\sim} 1 \Longrightarrow \\
  (\exists
  z\?A^\sim\_ xz =_{A^\sim} 1) \vee (\exists z\?A^\sim\_ yz =_{A^\sim} 1)\bigr).
\end{multline*}

The locale~$X$ on which this theater plays out is none other than the
\emph{spectrum of~$A$} from algebraic geometry, and the sheaf~$A^\sim$ is the
sheaf of regular functions. We will give details on its construction in
Section~\ref{sect:origins}, but first want to reflect on the displayed
statements.

\paragraph{A reification of all stalks.}
Statement~(\ref{item:stalks}) explains that, to a first approximation, the
sheaf~$A^\sim$ is a reification of all the stalks of~$A$ into a single coherent
entity: The sheaf~$A^\sim$ has exactly those properties which are shared by all
the stalks~$A_\fff$. For instance, the sheaf~$A^\sim$ is an integral domain iff
all the stalks are.

But crucially, this metatheorem only pertains to properties which can be
formulated as geometric sequents. Being an integral domain is such a property
($1 = 0 \vdash \bot$, $xy = 0 \seq{x:R,y:R} x = 0 \vee y = 0$), but many others
are not. The reductive power of harnessing~$A^\sim$ stems from the fact
that~$A^\sim$ enjoys properties which are not shared by~$A$, its stalks or
indeed any localizations or quotients.

\paragraph{Back and forth.}
Along with statement~(\ref{item:stalks}), statement~(\ref{item:iso}) is the main
reason why results about~$A^\sim$ imply results about~$A$. For instance, if we
want to show that a certain ring element~$x \in A$ is zero, we can just as well
show that its mirror image in~$A^\sim$ is zero.

For this step to be useful, we need to know what~$A^\sim$ looks like.
Statements~(\ref{item:stalks}) and~(\ref{item:loc-stable}) both allow us to
transfer our knowledge about~$A$ to~$A^\sim$; while
statements~(\ref{item:stalks}) requires a syntactic restriction on the property
under consideration, statement~(\ref{item:loc-stable}) requires a semantic one.

\paragraph{The field property.}
The fact that~$A^\sim$ is a field is where~$A^\sim$ derives its main usefulness
from. While statements~(\ref{item:loc-stable}), (\ref{item:stalks}) and
(\ref{item:local}) are immediate consequences of the way~$A^\sim$ is
constructed (Section~\ref{sect:origins}), the field property~(\ref{item:field})
requires an actual computation for its verification and was a surprising
discovery by Mulvey in the 1970s.

Tierney commented around that time that the field property ``is surely important,
though its precise significance is still somewhat obscure---as is the case with
many such nongeometric formulas''~\cite[p.~209]{tierney:spectrum}. Even though
the property has been known for a long time, only recently was it put in a
wider context and its its usefulness for constructive algebra
appreciated~\cite[Sections~3.3 and~11.4]{blechschmidt:phd}.

The field property is a unique feature of~$A^\sim$; it cannot be mimicked by
classical techniques in commutative algebra. Several constructions come close,
but fail in other ways:
\begin{enumerate}
\item The stalks~$A_\mmm$ at maximal ideals: These are not fields.
\item The stalks~$A_\ppp$ at minimal prime ideals: These are fields, but a ring
element~$x \in A$ which is zero in all these stalks~$A_\ppp$ is not necessarily
zero in~$A$. Also, an~$A$-module~$M$ which is finitely generated and whose
stalks~$M_\ppp$ at minimal prime ideals are free is ``free on a dense open'',
but this is false without the finiteness hypothesis. The analogous statement
for~$M^\sim$ and~$A^\sim$ holds in full generality (XXX reviewed below).
\item The quotients~$A/\mmm$: These are fields, but an element~$x \in A$ which is
zero in all these quotients~$A/\mmm$ is not necessarily zero in~$A$, and
passing to~$A/\mmm$ is not exact (does not preserve injectivity of linear
maps).
\item The quotients~$A/\ppp$ modulo the prime ideals: These are merely integral
domains.
\end{enumerate}
%\item If a ring element~$x \in A$ is zero in all stalk~$A_\mmm$ at maximal
%ideals, then~$x$ is zero in~$A$. However, the rings~$A_\mmm$ are not fields.
%\item The rings~$A/\mmm$ are fields, but a ring element~$x \in A$ which is zero
%in all these quotients~$A/\mmm$ is not necessarily zero in~$A$.
%\item If a ring element~$x \in A$ is zero in all quotients~$A/\ppp$,
%where~$\ppp$ ranges over the prime ideals, then~$x$ is zero in~$A$. However,
%the rings~$A/\ppp$ are merely integral domains.
%\item The stalks~$A_\ppp$, where~$\ppp$ ranges over the minimal prime ideals,
%are fields. However, a ring element~$x \in A$ which is zero
%in all these stalks~$A_\ppp$ is not necessarily zero in~$A$.

The field condition displayed in statement~(\ref{item:field}) is not the only
such condition used in constructive algebra. For instance, a stronger condition
is ``any element is zero or invertible'' and a further, incomparable, condition
is ``any nonzero element is invertible''.

XXX when those other conditions satisfied

\paragraph{Double negation stability.}
XXX explain that it is surprising and explain usefulness, then give proof

\begin{proposition}The sheaf of rings~$A^\sim$ has $\neg\neg$-stable equality:
\[ \Spec(A) \models \forall x,y\?A^\sim\_ \neg\neg(x = y) \Rightarrow x = y. \]
\end{proposition}

\begin{proof}We argue internally. Let~$x,y \? A^\sim$ be given such
that~$\neg\neg(x = y)$. We will verify that~$x - y$ is not invertible; by the
field condition, this will imply~$x - y = 0$, hence~$x = y$.

So assume that~$x - y$ is invertible. Then~$\neg(x - y = 0)$, since if~$x - y =
0$, then~$1 = (x-y) (x-y)^{-1} = 0$ in contradiction to~$1 \neq 0$. This is a
contradiction to the assumption~$\neg\neg(x-y=0)$.\end{proof}


\paragraph{The Noetherian property.}
XXX not shared by stalks; ``true constructivists would be offended''

\begin{proposition}The sheaf of rings~$A^\sim$ is anonymously
Noetherian.\end{proposition}

\begin{proof}We argue internally. Let~$\aaa \subseteq A^\sim$ be an ideal.
Assume that~$\aaa$ is not finitely generated. We will verify that then~$\aaa =
(0)$, hence that~$\aaa$ is finitely generated; contradiction.

Let~$x \in \aaa$. If~$x$ is invertible, then~$\aaa = (1)$ is finitely
generated. Hence~$x$ is not invertible. Thus~$x = 0$ because~$A^\sim$ is a
field.
\end{proof}


\subsection{The origins of the sheaf}
\label{sect:origins}
XXX better title

XXX universal localization...

XXX proofs of (B), (C), (D)

\begin{theorem}Let~$A$ be a ring. The Lindenbaum algebra of the theory of prime
filters of~$A$ is canonically isomorphic to the frame of radical ideals in~$A$.
\end{theorem}

\begin{proof}The set of radical ideals is ordered by inclusion. The meet~$\aaa
\wedge \bbb$ of two radical ideals is their intersection and the
join~$\bigvee_i \aaa_i$ of radical ideals is~$\sqrt{\sum_i \aaa_i}$.

The desired isomorphism maps~$[\alpha_x]$ to~$\sqrt{(x)}$ and maps finite meets
to finite meets and arbitrary joins to arbitrary joins, as it should be. A
computation shows that it is well-defined and monotone. For instance, in the
Lindenbaum algebra, we have~$[\alpha_x] \wedge [\alpha_y] \preceq
[\alpha_{xy}]$, and indeed~$\sqrt{(x)} \cap \sqrt{(y)} \subseteq \sqrt{(xy)}$.
XXX: surjective and order-reflecting
\end{proof}


\subsection{Applications}
\label{sect:example-applications}
XXX better title

XXX injective matrices

XXX generic freeness

XXX spell out details of field property

\end{document}

XXX cite https://apcz.umk.pl/czasopisma/index.php/LLP/article/viewFile/LLP.2013.009/732

XXX include rules for geometric logic?

X \models phi
