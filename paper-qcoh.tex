\documentclass[oneside,reqno]{amsart}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsthm,mathtools,stmaryrd,amssymb,graphicx}
\usepackage{booktabs}
\usepackage[all]{xy}
\usepackage[protrusion=true,expansion=true]{microtype}
\usepackage{xspace}

\usepackage[natbib=true,style=numeric,maxnames=10]{biblatex}
\usepackage[babel]{csquotes}
\bibliography{paper-qcoh.bib}

\title{A general Nullstellensatz for generalized spaces}
\author{Ingo Blechschmidt}
\email{ingo.blechschmidt@univr.it}

\theoremstyle{definition}
\newtheorem{defn}{Definition}[section]
\newtheorem{ex}[defn]{Example}

\theoremstyle{plain}
\newtheorem{prop}[defn]{Proposition}
\newtheorem{cor}[defn]{Corollary}
\newtheorem{lemma}[defn]{Lemma}
\newtheorem{thm}[defn]{Theorem}
\newtheorem{scholium}[defn]{Scholium}

\theoremstyle{remark}
\newtheorem{rem}[defn]{Remark}
\newtheorem{question}[defn]{Question}
\newtheorem{speculation}[defn]{Speculation}
\newtheorem{caveat}[defn]{Caveat}
\newtheorem{conjecture}[defn]{Conjecture}

\newenvironment{indentblock}{%
  \list{}{\leftmargin\leftmargin}%
  \item\relax
}{%
  \endlist
}

\newcommand{\xra}[1]{\xrightarrow{#1}}
\newcommand{\aaa}{\mathfrak{a}}
\newcommand{\bbb}{\mathfrak{b}}
\newcommand{\mmm}{\mathfrak{m}}
\newcommand{\C}{\mathcal{C}}
\newcommand{\I}{\mathcal{I}}
\newcommand{\J}{\mathcal{J}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\B}{\mathcal{B}}
\renewcommand{\AA}{\mathbb{A}}
\newcommand{\EE}{\mathbb{E}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\TT}{\mathbb{T}}
\newcommand{\ZZ}{\mathbb{Z}}
\renewcommand{\SS}{\mathbb{S}}
\renewcommand{\P}{\mathcal{P}}
\renewcommand{\O}{\mathcal{O}}
\newcommand{\defeq}{\vcentcolon=}
\newcommand{\op}{\mathrm{op}}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Sh}{Sh}
\DeclareMathOperator{\PSh}{PSh}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\length}{length}
\DeclareMathOperator{\List}{List}
\DeclareMathOperator{\id}{id}
\newcommand{\Set}{\mathrm{Set}}
\newcommand{\Eff}{\mathrm{Ef{}f}}
\renewcommand{\_}{\mathpunct{.}\,}
\newcommand{\effective}{ef{}fective\xspace}
\newcommand{\?}{\,{:}\,}
\newcommand{\realizes}{\Vdash}
\newcommand{\notnot}{\emph{not~not}\xspace}
\usepackage{soul}\setul{0.3ex}{}
\let\oldul\ul
\renewcommand{\ul}[1]{\text{\oldul{$#1$}}}
\newcommand{\affl}{\ensuremath{{\ul{\AA}^1}}\xspace}
\newcommand{\speak}[1]{\ulcorner\text{\textnormal{#1}}\urcorner}
\newcommand{\brak}[1]{\llbracket #1 \rrbracket}
\newcommand{\Mod}[1]{{#1}\mathrm{\text{-}mod}}

\newcommand{\stacksproject}[1]{\cite[{\href{https://stacks.math.columbia.edu/tag/#1}{Tag~#1}}]{stacks-project}}

\renewcommand{\paragraph}[1]{\noindent\textbf{#1.}}

\newcommand{\ZFC}{\textsc{zfc}}

\newcommand{\seq}[1]{\mathrel{\vdash\!\!\!_{#1}}}

\begin{document}

\begin{abstract}
  We give a general Nullstellensatz for the generic model of a
  geometric theory, useful as a source of nongeometric sequents validated by
  the generic model, and characterize the first-order formulas validated by the
  genetric model. XXX
\end{abstract}

\maketitle
\thispagestyle{empty}

\section{Introduction}

\paragraph{Generic models} Let~$\TT$ be a geometric theory, such as the theory
of rings, local rings or intervals. We follow Caramello's
terminology~\cite{caramello:tst} to mean by \emph{geometric theory} a system
given by a set of sorts, a set of finitary function symbols, a set of finitary
relation symbols and a set of axioms, consisting of geometric sequents
(sequents of the form~$\varphi \seq{\vec x} \psi$ where~$\varphi$ and~$\psi$
are geometric formulas, that is formulas built from equality and the relation
symbols by the logical connectives~${\top}\,{\bot}\,{\wedge}\,{\vee}\,{\exists}$
and by arbitrary set-indexed disjunctions~$\bigvee$). By \emph{first-order
formula} we will mean a formula which may contain, additionally to the
connectives allowed for geometric formulas, the connectives~${\Rightarrow}$
and~${\forall}$.

A fundamental result is that there is a \emph{generic model}~$U_\TT$ of~$\TT$,
a model such that for any geometric sequent~$\sigma$, the following notions
coincide:
\begin{enumerate}
\item The sequent~$\sigma$ is provable modulo~$\TT$.
\item The sequent~$\sigma$ holds for any~$\TT$-model in any Grothendieck topos.
\item The sequent~$\sigma$ holds for~$U_\TT$.
\end{enumerate}
One could argue that it is this model which mathematicians
implicitly refer to when they utter the phrase ``Let~$M$ be a~$\TT$-model.''. It can
typically not be realized as a set-theoretic model, consisting of a set for
each sort, a function for each function symbol and so on; instead it is a model
in a custom-tailored syntactically constructed Grothendieck topos, the
\emph{classifying topos}~$\Set[\TT]$ of~$\TT$, hence consists of an object
of~$\Set[\TT]$ for each sort, a morphism for each function symbol and so on.

To state what it means for a~$\TT$-structure in a topos~$\E$ to verify the
axioms of~$\TT$, rendering it a model, the \emph{internal language} of~$\E$ is
used, roughly reviewed in Section~\ref{sect:review} below. We write~``$\E
\models \alpha$'' to mean that a formula~$\alpha$ holds from the internal
point of view of~$\E$. Since this language is a form of a higher-order
intuitionistic extensional dependent type theory, the classifying topos~$\Set[\TT]$ can
be regarded as a higher-order completion of the geometric theory~$\TT$. The
generic model enjoys the universal property that any~$\TT$-model in any
(Grothendieck) topos~$\E$ is the pullback of~$U_\TT$ along an essentially
unique geometric morphism~$\E \to \Set[\TT]$.
\medskip

\paragraph{Nongeometric sequents} Crucially, the
equivalence~$(1)\Leftrightarrow(2)\Leftrightarrow(3)$ relating
provability and truth in~$\Set[\TT]$ only pertains to geometric sequents. The
generic model may validate additional nongeometric sequents which are not
provable from the axioms of~$\TT$ in first-order or even higher-order logic,
and these nongeometric sequents may be quite surprising and have useful
consequences.

One of the most celebrated such sequents arises in the case that~$\TT$ is the
theory of local rings. In this case, the classifying topos~$\Set[\TT]$ is also
known as the \emph{big Zariski topos} of~$\Spec(\ZZ)$ from algebraic geometry,
the topos of sheaves over the site of schemes locally of finite presentation,
and the generic model is the functor~$\affl$ of points of the affine line, the
functor which maps any (l.o.f.p.) scheme~$X$ to~$\Hom(X,\mathbb{A}^1) =
\O_X(X)$.

From the point of view of the topos, the ring object~$\affl$ is not only a
local ring, but even a field in the sense that
any nonzero element is invertible.
As this condition is of nongeometric form, it is not inherited by arbitrary
local rings, which are indeed typically not fields. However, any intuitionistic
consequence of this condition which is of geometric form is inherited
by any local ring in any topos. Hence we may, when verifying a general fact
about local rings which is expressible as a geometric sequent,
suppose without loss of generality that the given ring is a
field. This observation is due to Kock~\cite{kock:univ-proj-geometry}, who exploited it to
develop projective geometry over local rings, and was further used by Reyes to
prove a Jacobian criterion for Ã©tale morphisms~\cite{reyes:cramer}.

A related nongeometric sequent is valid in the little Zariski topos of the
spectrum of a ring~$A$, the classifying topos of local localizations of~$A$.
If~$A$ is reduced, the generic model validates the dual condition that any
noninvertible element is zero. This property has been used to give a short and
even constructive proof of Grothendieck's generic freeness lemma,
substantially improving on previously published
proofs~\cite{blechschmidt:generic-freeness}.

In time, further nongeometric sequents holding in the big Zariski topos of an
arbitrary base scheme have been found~\cite[Section~18.4]{blechschmidt:phd}. These include:
\begin{itemize}
\item $\affl$ is \emph{anonymously algebraically closed} in the sense that
any monic polynomial~$p \? \affl[T]$ of degree at least one does \notnot have a
zero. \smallskip
\item The Nullstellensatz holds:
Let $f_1,\ldots,f_m \in \affl[X_1,\ldots,X_n]$ be polynomials without a common
zero in~$(\affl)^n$. Then there are polynomials~$g_1,\ldots,g_m \in
\affl[X_1,\ldots,X_n]$ such that~$\sum_i g_i f_i = 1$. \smallskip
\item Any function~$\affl \to \affl$ is given by a unique polynomial. \smallskip
\item $\affl$ is microaffine: Let~$\Delta = \{ \varepsilon \?
\affl \,|\, \varepsilon^2 = 0 \}$. Let~$f : \Delta \to \affl$ be an arbitrary
function. Then there are unique elements~$a, b \? \affl$ such
that~$f(\varepsilon) = a + b \varepsilon$ for all~$\varepsilon \? \Delta$. \smallskip
\item $\affl$ is \emph{synthetically quasicoherent}: For any
finitely presented~$\affl$-algebra~$A$, the canonical homomorphism~$A \to
(\affl)^{\Spec(A)}$, where~$\Spec(A)$ is defined as the set
of~$\affl$-algebra homomorphisms~$A \to \affl$, is bijective.
\end{itemize}
All of these nongeometric sequents are useful for the purposes of synthetic
algebraic geometry, the desire to carry out algebraic geometry in a language
close to the simple language on the 19th and the beginning of the 20th century
while still being fully rigorous and fully general, working over arbitrary base
schemes instead of restricting to the field of complex numbers.
\medskip

\paragraph{Characterizing nongeometric sequents} Referring to one of the previous
examples, Tierney remarked around the time that those sequents were first
studied that ``[it] is surely important, though its precise significance is
still somewhat obscure---as is the case with many such nongeometric
formulas''~\cite[p.~209]{tierney:spectrum}. In view of their importance, is
there a way to discover nongeometric sequents in a systematic fashion? To
characterize the nongeometric sequents holding in classifying toposes? To this
end, Wraith put forward a specific conjecture~\cite[p.~336]{wraith:intuitionistic-algebra}:
\begin{quote}
\emph{The problem of characterising all the non-geometric properties of a generic
model appears to be difficult. If the generic model of a geometric theory~$\TT$
satisfies a sentence~$\alpha$ then any geometric consequence of $\TT + \alpha$ has to be a
consequence of~$\TT$. We might call~$\alpha$ $\TT$-redundant. Does the
generic~$\TT$-model satisfy all~$\TT$-redundant sentences?}
\end{quote}
This question was recently answered in the negative by Bezem, Buchholtz and
Coquand~\cite{bezem-buchholtz-coquand:syntactic-forcing-models}; hence the
characterization we propose is necessarily more nuanced.

Our starting point was the empirical
observation~\cite[p.~164]{blechschmidt:phd} that in the case of the big
Zariski topos, every true known nongeometric sequent followed from just a
single such, namely the synthetic quasicoherence of the generic
model, and in earlier work we surmised that one could formulate an appropriate
metatheorem explaining this observation and generalizing it to arbitrary
classifying toposes~\cite[Speculation~22.1]{blechschmidt:phd}. This hope turned
out to be true, in the sense we will now indicate.
\medskip

\paragraph{A general Nullstellensatz} To explain the relevant background, the
somewhat vague question ``to which extent does the classifying
topos~$\Set[\TT]$ realize that it is the classifying topos for~$\TT$?'' is a
useful guiding principle. This is easiest to visualize with a concrete example
for~$\TT$, such as the theory of rings.

Let~$A$ be a ring. A simple version of the classical Nullstellensatz states:
\emph{For any polynomials~$f$ and~$g$ over~$A$, if any zero of~$f$ is also a
zero of~$g$, then there is a polynomial~$h$ such that~$g = hf$.} The
polynomial~$h$ can be regarded as an ``algebraic certificate'' of the
hypothesis. This principle holds for instance in the case that~$A$ is an
algebraically closed field and that~$g$ is the unit polynomial. We will see
below that it is also
true, without any restriction on~$g$, for the generic ring.

We could try to generalize the Nullstellensatz to arbitrary geometric theories~$\TT$ as
follows: \emph{For any geometric sequent~$\sigma$, if~$\sigma$ holds for a
given~$\TT$-model~$M$ then~$\sigma$ is provable modulo~$\TT$.} In place of the
algebraic certificate we now have a logical certificate, a \emph{proof}
of~$\sigma$. However, this generalized statement is typically false, even for
the generic model~$U_\TT$: The statement
\begin{multline*}
  \qquad\qquad\qquad\Set[\TT] \models \ulcorner\text{for any geometric sequent~$\sigma$,} \\
    \text{if~$\sigma$ holds for~$U_\TT$ then~$\ul{\TT}$
    proves~$\sigma$}\urcorner\qquad\qquad\qquad
\end{multline*}
does not hold.\footnote{Here~$\ul{\TT}$ is the internal geometric theory induced
by~$\TT$, obtained by pulling back the set of sorts, the set of function
symbols and so on along the geometric morphism~$\Set[\TT] \to \Set$. For
instance, if~$\TT$ is the theory of rings, then from the internal point of view
of~$\Set[\TT]$ the theory~$\ul{\TT}$ will again be the theory of rings.
More details will be given in Section~\ref{sect:review}. The corner quotes indicate
that for sake of readability, the translation into formal language is to be
carried out by the reader. \par The displayed statement is much stronger than
the statement that for any geometric sequent~$\sigma$, if $\Set[\TT] \models
\speak{$\sigma$ holds for~$U_\TT$}$ then~$\TT$ proves~$\sigma$. This latter statement,
where the universal quantifier and the ``if \ldots then'' have been pulled out,
is true.} In this sense~$\Set[\TT]$ does not believe that~$U_\TT$ is the
generic~$\ul{\TT}$-model.

A concrete counterexample is as follows. Let~$\TT$ be the theory of rings and let~$\sigma$ be
the sequent~$(\top \vdash 1 + 1 = 0)$. Since there is an intuitionistic proof
that~$\TT$ does not prove~$\sigma$ and toposes are sound with respect to
intuitionistic logic, the statement~$\speak{\ul{\TT} proves~$\sigma$}$ is false
from the internal point of view of~$\Set[\TT]$. However, it is not the case
that the statement~$\speak{$1 + 1 = 0$ in~$U_\TT$}$ is false from the internal
point of view. In fact, this statement holds in a nontrivial slice
of~$\Set[\TT]$, the open subtopos coinciding with the classifying topos of
the theory of rings of characteristic two.

Intuitively, the problem is that while the meaning of~$\speak{$\ul{\TT}$
proves~$\sigma$}$ is fixed, the meaning of~$\speak{$\sigma$ holds for~$U_\TT$}$ can vary
with the slice. This problem can be solved by passing from~$\ul{\TT}$ to a
varying theory, the internal theory~$\ul{\TT}/U_\TT$ defined in
Section~\ref{sect:main}. If~$\TT$ is the theory of rings, then~$\ul{\TT}/U_\TT$
is the~$\Set[\TT]$-theory of~$U_\TT$-algebras.
Unlike~$\ul{\TT}$, this theory is not the pullback of an external geometric
theory. We then have, subject to some qualifications made precise in
Section~\ref{sect:main}, the following general Nullstellensatz:

\begin{thm}\label{thm:nullstellensatz0}
Let~$\TT$ be a geometric theory. Then, internally to~$\Set[\TT]$:
\begin{equation}\tag{$\ddagger$}\label{eq:nullstellensatz}
\text{A geometric$^*$ sequent~$\sigma$ holds for~$U_\TT$ if and only
if~$\ul{\TT}/U_\TT$ proves$^*$~$\sigma$.}
\end{equation}
\end{thm}

To illustrate Theorem~\ref{thm:nullstellensatz0}, let~$\TT$ be the theory of
rings and let~$\sigma$ be the sequent~$(f(x) = 0 \seq{x} g(x) = 0)$ for some
polynomials~$f$ and~$g$. To say that~$\sigma$ holds for~$U_\TT$ amounts to
saying that any zero~$x \? U_\TT$ of~$f$ is also a zero of~$g$, and to say
that~$\ul{\TT}/U_\TT$ proves~$\sigma$ amounts to saying that
in~$U_\TT[X]/(f(X))$, the free~$U_\TT$-algebra on one generator~$X$ subject to
the relation~$f(X) = 0$, the relation~$g([X]) = 0$ holds. Hence we obtain
\[ \Set[\TT] \models
  \forall f,g \? U_\TT[X]\_ \bigl(
    (\forall x \? U_\TT\_ f(x) = 0 \Rightarrow g(x) = 0) \Longleftrightarrow
      \exists h \in U_\TT[X]\_ g = hf\bigr). \]

The statement~\eqref{eq:nullstellensatz} is not a geometric sequent. Therefore
it is not to be expected that it passes from~$\Set[\TT]$ to a
subtopos~$\Set[\TT']$ corresponding to a quotient theory~$\TT'$ of~$\TT$, and
indeed in general it does not. We formulate a substitute as Theorem~XXX,
substantially broadening the scope of the Nullstellensatz.

Summarizing, the situation is as follows.
\begin{itemize}
\item The generic model~$U_\TT$ is a
conservative~$\TT$-model. \smallskip
\item The topos~$\Set[\TT]$ does not believe that~$U_\TT$ is a
conservative~$\ul{\TT}$-model. \smallskip
\item The topos~$\Set[\TT]$ does believe that~$U_\TT$
is a conservative$^\star$~$\ul{\TT}/U_\TT$-model.
\end{itemize}

Theorem~\ref{thm:nullstellensatz0} is a source of nongeometric sequents. Indeed,
it is the universal such source in the sense that any first-order formula
which holds for~$U_\TT$ can be deduced from~\eqref{eq:nullstellensatz}:

\begin{thm}\label{thm:characterization0}
Let~$\TT$ be a geometric theory. Let~$\alpha$ be a first-order
formula over the signature of~$\TT$. Then the following statements are
equivalent.
\begin{enumerate}
\item The formula~$\alpha$ holds for~$U_\TT$.
\item The formula~$\alpha$ is provable in first-order intuitionistic logic
modulo the axioms of~$\TT$ and the additional axiom
scheme~\eqref{eq:nullstellensatz}.
\end{enumerate}
\end{thm}

Theorem~\ref{thm:characterization0} characterizes which first-order formulas
hold for the generic model. We could of course wish for a more explicit
characterization; but since even the characterization of geometric sequents
holding for the generic model (they are precisely those which are provable in
geometric logic modulo~$\TT$) is of a rather implicit nature, this wish appears
unfounded.

We stress that our characterization is more explicit than the tautologous
characterization (``a first-order formula holds for~$U_\TT$ iff it is provable
in~$\TT'$, where~$\TT'$ is the first-order theory whose set of axioms is the
set of first-order formulas satisfied by~$U_\TT$'') and the (incorrect)
characterization ``a first-order formula holds for~$U_\TT$ iff it
is~$\TT$-redundant''. Indeed, if~$\TT$ happens to be coherent and recursively
axiomatizable, then in stating Theorem~\ref{thm:characterization0} we may
restrict to coherent existential fixed-point logic, and the resulting theory
will again be recursively axiomatizable.
\medskip


\paragraph{Acknowledgments} XXX


\section{Background on classifying toposes}

\section{Proofs of the main theorems}

The following lemma shows that for coherent theories, there is no difference
between provability and provability$^*$.

\begin{lemma}Let~$\E$ be a Grothendieck topos. Let~$\TT$ be a coherent theory
internal to~$\E$. Let~$\sigma$ be a coherent sequent over the signature
of~$\TT$. Then the following statements are equivalent.
\begin{enumerate}
\item $\E \models \speak{There is a~$\TT$-derivation of~$\sigma$ of externally
finite shape}.$
\item $\E \models \speak{There is a~$\TT$-derivation of~$\sigma$ of arbitrary
external shape}.$
\item $\E \models \speak{There is a~$\TT$-derivation of~$\sigma$ of arbitrary
internal shape}.$
\item $\E \models \speak{There is a~$\TT$-derivation of~$\sigma$ of internally
finite shape}.$
\end{enumerate}
\end{lemma}

\begin{proof}It is trivial that~(1) implies~(2) implies~(3).

To verify that~(3) implies~(4), we can mimic the usual proof of this fact in
the internal language of~$\E$: There is a variant of the syntactic
site of~$\TT$ which is built using only coherent sequents and finitary
derivability~\cite[Section~1.4]{caramello:tst}. The sheaf topos over this site
is another model for the classifying topos of~$\TT$, and still validates, like
any Grothendieck topos, full infinitary logic. Hence, if~$\sigma$
is~$\TT$-derivable by a proof tree of arbitrary shape, then~$\sigma$ holds in
this model of the classifying topos. By the analogue of
Proposition~\ref{prop:classifying-topos} for this model, we obtain
that~$\sigma$ is~$\TT$-derivable by a proof tree of finite shape.

That~(4) implies~(1) is a routine exercise exploiting that
\[ \E \models \forall X\_ \speak{$X$ is Kuratowski-finite} \Leftrightarrow
  \bigvee_{n \geq 0} \exists x_1,\ldots,x_n \? X\_
  \forall x \? X\_ \bigvee_{i=1}^n x = x_i. \qedhere \]
\end{proof}

\begin{lemma}\label{lemma:truth-to-provability}
Let~$\TT$ be a geometric theory. Let~$\alpha$ be a geometric formula over the
signature of~$\TT$ in a context~$x_1\?X_1,\ldots,x_n\?X_n$. Then
\[ \{ \vec x\_ \alpha \} \models \speak{$\ul{\TT}/U_\TT$ proves $(\top
\vdash_{[]} \alpha)$}, \]
where the free variables~$\vec x$ occurring in~$\alpha$ are interpreted by
their generic values over~$\{ \vec x\_ \alpha \}$, that is the projection
maps~$\{ \vec x\_ \alpha \} \to \{ x_i\?X_i\_ \top \}$.
\end{lemma}

\begin{proof}By induction on the structure of~$\alpha$. The cases
of~``$\top$'' and ``$\wedge$'' are trivial; the cases of~``$\bigvee$''
and~``$\exists$'' follow from passing to suitable coverings; and the case of
atomic propositions is by definition of~$\ul{\TT}/U_\TT$.
\end{proof}

\begin{lemma}\label{lemma:locally-constant}
Let~$\TT$ be a geometric theory.
Let~$\varphi$ be a section of the sheaf of geometric$^\star$ formulas over the signature
of~$\ul{\TT}/U_\TT$ over a stage~$A \in \C_\TT$. Then there is a covering~$(A_i \to A)_i$
of~$A$ such that for each index~$i$, there is a formula~$\varphi_i$ over the signature
of~$\TT/U_\TT(A_i)$ such that~$A_i \models \speak{$\ul{\TT}/U_\TT$ proves$^\star$
$(\varphi \dashv\vdash \varphi_i)$}$.
\end{lemma}

\begin{proof}By passing to a covering, we may suppose that~$\varphi$ is given
by an (external) geometric formula over the signature
of~$\ul{\TT}(A)/U_\TT(A)$.

Any function symbol and relation symbol
of~$\ul{\TT}(A)$ occurring in~$\varphi$ is locally given by a symbol of~$\TT$.
Hence the claim would be trivial if~$\varphi$ were a coherent formula, for in
this case we would just have to pass to further coverings, one for each
occuring symbol, a finite number of times in total.

However, in general, we cannot conclude as easily. Write~$A = \{ \vec x\_
\alpha \}$. Let~$R$ be a relation symbol of~$\ul{\TT}(A)$ occuring
in~$\varphi$. By the explicit description of constant sheaves as sheaves of
locally constant maps, there is a covering~$(\{ \vec y_j\_ \alpha_j \}
\xrightarrow{[\theta_j]} \{ \vec x\_ \alpha \})_j$ such that, restricted to~$\{
\vec y_j\_ \alpha_j \}$, $R$ is given by a relation symbol~$R_j$ of~$\TT$. To construct
the desired formula~$\varphi'$, we replace any such occurrence~$R(\ldots)$
in~$\varphi$ by
\[ \bigvee_j \bigl((\exists \vec y_j\_ \theta_j) \wedge R_j(\ldots)\bigr). \]
In a similar vein we treat any occurrence of function symbols.

The verification of~$A \models \speak{$\ul{\TT}/U_\TT$ proves$^\star$
$(\varphi \dashv\vdash \varphi')$}$ rests on the observation
\[ A \models \speak{$\ul{\TT}/U_\TT$ proves$^\star$ $\bigl((\exists \vec y_k\_
\theta_k) \seq{[]} \bigvee_k \{ \top \,|\, \text{$(\exists \vec y_k\_ \theta_k)$
holds for~$U_\TT$} \}\bigr)$} \]
which in turn can be checked on the covering~$(\{ \vec y_j\_ \alpha_j \}
\xrightarrow{[\theta_j]} \{ \vec x\_ \alpha \})_j$, applying
Lemma~\ref{lemma:truth-to-provability} and using that~$\TT$ (and
hence~$\ul{\TT}$) proves~$(\exists \vec y_j\_ \theta_j) \wedge (\exists \vec
y_k\_ \theta_k) \seq{\vec x} \bigvee \{ \top \,|\, j = k \}$.
\end{proof}

\begin{thm}\label{thm:nullstellensatz}
Let~$\TT$ be a geometric theory. Then, internally to~$\Set[\TT]$, for any
geometric$^\star$ sequent~$\sigma$ over the signature of~$\ul{\TT}/U_\TT$, the
following statements are equivalent:
\begin{enumerate}
\item The sequent~$\sigma$ holds for~$U_\TT$.
\item The sequent~$\sigma$ is provable$^\star$ modulo~$\ul{\TT}/U_\TT$.
\end{enumerate}
\end{thm}

\begin{proof}The direction~$(2) \Rightarrow (1)$ is immediate because~$U_\TT$ is, from the
internal point of view of~$\Set[\TT]$, a~$\ul{\TT}/U_\TT$-model. Hence even the
following stronger statement holds internally: \emph{For any geometric
sequent~$\sigma$, if~$\ul{\TT}/U_\TT$ proves~$\sigma$, then~$\sigma$ holds
for~$U_\TT$.}

For the direction~$(1) \Rightarrow (2)$ we have to verify that, given any
stage~$A \in \C_\TT$ and any section~$\sigma$ of the sheaf of
geometric$^\star$ sequents over~$A$, if~$A \models
\speak{$\sigma$ holds for~$U_\TT$}$ then~$A \models
\speak{$\ul{\TT}/U_\TT$ proves$^\star$~$\sigma$}$. By
Lemma~\ref{lemma:locally-constant} we may suppose that~$\sigma$ is an
(external) geometric sequent over the signature of~$\TT/U_\TT(A)$.

Writing~$A = \{ \vec x\_ \alpha \}$ and~$\sigma = (\varphi \seq{\vec y} \psi)$,
we have~$\{ \vec x\_ \alpha \} \models \forall y\_ (\varphi \Rightarrow \psi)$,
hence~$\{ \vec x, \vec y\_ \alpha \wedge \varphi \} \models \psi$. Thus~$\TT$
proves~$(\alpha \wedge \varphi \seq{\vec x, \vec y} \psi)$. This proof can be
pulled back from~$\Set$ to~$\Set[\TT]/A$ to show~$A \models
\speak{$\ul{\TT}/U_\TT$ proves$^\star$~$(\alpha
\wedge \varphi \seq{\vec x, \vec y} \psi)$}$. By
Lemma~\ref{lemma:truth-to-provability}, we also have~$A \models
\speak{$\ul{\TT}/U_\TT$ proves$^\star$~$(\top \seq{[]} \alpha)$}$ (where the free
variables occuring in~$\alpha$ are interpreted as the generic values available
over~$A$), hence~$A \models \speak{$\ul{\TT}/U_\TT$ proves$^\star$~$(\varphi
\seq{\vec y} \psi)$}$.
\end{proof}

\begin{thm}\label{thm:nullstellensatz-horn}
Let~$\TT$ be a geometric theory. Let~$\TT'$ be a quotient theory
of~$\TT$. Assume that the generic model~$U_\TT$ is a sheaf for the topology
on~$\Set[\TT]$ cutting out the subtopos~$\Set[\TT']$. Then the following
statement holds internally to~$\Set[\TT']$:
\[ \text{A geometric$^\star$ sequent~$\sigma$ with Horn consequent holds for~$U_{\TT'}$
  iff~$\ul{\TT}/U_\TT$ proves$^\star$~$\sigma$.} \]
\end{thm}

\begin{proof}In general, the generic model of~$\TT'$ is the pullback of the
generic model of~$\TT$ to the
subtopos~$\Set[\TT']$~\cite[Lemma~2.3]{caramello:definability}. By the sheaf
assumption, the objects~$U_{\TT'}$ and~$U_\TT$ actually agree, that is~$U_\TT$
is contained in the subtopos and has the universal property of~$U_{\TT'}$.

The ``if'' direction is trivial, as~$U_{\TT'}$ is a~$\ul{\TT}/U_\TT$-model.

For the ``only if'' direction, we use that a statement holds in~$\Set[\TT']$ if
and only if its~$\nabla$-translation holds in~$\Set[\TT]$, where~$\nabla$ is
the modal operator associated to the topology cutting
out~$\Set[\TT']$~\cite[Theorem~6.31]{blechschmidt:phd}. Exploiting some of the
simplification rules of the~$\nabla$-translation~\cite[Section~6.6]{blechschmidt:phd},
it hence suffices to verify, internally to~$\Set[\TT]$, that:
\begin{multline*}
  \text{\emph{For any geometric$^\star$ sequent~$\sigma = (\varphi \seq{\vec x} \psi)$ where~$\psi$ is a Horn formula,}} \\
    \text{\emph{if~$\forall x_1,\ldots,x_n\?U_\TT\_ (\varphi \Rightarrow \nabla
    \psi)$, then~$\ul{\TT}/U_\TT$ proves$^\star$~$\sigma$.}}
\end{multline*}
Since~$\nabla$ commutes with finite conjunctions and since the sheaf assumption
implies that $\nabla(s = t)$ is equivalent
to~$s = t$ and that, for relation symbols~$R$, the
statement~$\nabla(R(s_1,\ldots,s_m))$ is equivalent to~$R(s_1,\ldots,s_m)$,
the statement~$\nabla\psi$ is equivalent to~$\psi$. Hence the claim follows
from Theorem~\ref{thm:nullstellensatz}.
\end{proof}

A situation in which the sheaf assumption of Theorem~\ref{thm:nullstellensatz-horn}
is satisfied is when~$\TT$ is a Horn theory and the topology cutting
out~$\Set[\TT']$ is subcanonical. For instance, this is the case if~$\TT$ is
the theory of rings and~$\Set[\TT']$ is one of several well-known toposes in
algebraic geometry such as the big Zariski topos, the big Ã©tale topos or the
big fppf topos.

\begin{thm}\label{thm:characterization}
Let~$\TT$ be a geometric theory. Let~$\alpha$ be a first-order
formula over the signature of~$\TT$. Then the following statements are
equivalent.
\begin{enumerate}
\item The formula~$\alpha$ holds for~$U_\TT$.
\item The formula~$\alpha$ is provable in first-order intuitionistic logic
modulo the axioms of~$\TT$ and the additional axiom
scheme~\eqref{eq:nullstellensatz}.
\end{enumerate}
\end{thm}

\begin{proof}The direction~$(1) \Rightarrow (2)$ is immediate, as the internal
language of~$\Set[\TT]$ validates first-order intuitionistic logic and the
axiom scheme~\eqref{eq:nullstellensatz} by Theorem~\ref{thm:nullstellensatz}.

For the converse direction, we note that, given a geometric sequent~$\sigma$
over the signature of~$\TT$, the statement~$\speak{$\ul{\TT}/U_\TT$
proves$^\star$~$\sigma$}$ can be expressed as a geometric formula over the
signature of~$\TT$. Applying this observation successively to subformulas
of the given formula~$\alpha$, Theorem~\ref{thm:nullstellensatz} on the
semantic side and the axiom scheme~\eqref{eq:nullstellensatz} on the syntactic side imply that we may
assume that~$\alpha$ is in fact a geometric formula. Hence we are reduced to
the basic fact that, for geometric formulas~$\varphi$, $\Set[\TT] \models
\varphi$ implies that~$\TT$ proves~$\varphi$.
\end{proof}

% XXX coherent case


\section{The special case of Horn theories}

Throughout this section, let~$\TT$ be a Horn theory.

\begin{lemma}\label{lemma:free-models}
Let~$X$ be a set equipped with a morphism~$X \to S$ to the set of sorts
of the signature~$\Sigma$ of~$\TT$. Let~$R$ be a set of atomic propositions in which the
elements of~$X$ may appear as new constants of the respective sorts. Then there
is~$\TT\langle X | R \rangle$, the free~$\TT$-model on the generators~$X$ modulo
the relations~$R$.\end{lemma}

\begin{proof}The desired model can be constructed as a term algebra. As a set,
it consists of the terms (in the empty context) of the signature~$\Sigma + X$
modulo the equivalence relation identifying two terms if and only if~$\TT + R$
proves them to be equal. The function symbols~$f$ of~$\Sigma$ are interpreted
by declaring~$\brak{f}([t_1],\ldots,[t_n]) = [f(t_1,\ldots,t_n)]$ and the
relation symbols~$S$ are interpreted by declaring~$([t_1],\ldots,[t_n]) \in
\brak{S} \Leftrightarrow (\TT + R \vdash S(t_1,\ldots,t_n))$.

We omit the required verifications and only remark that while the same
construction could be carried out if~$\TT$ is a general geometric theory, the
resulting object would in general not be a model of~$\TT$.
\end{proof}

\begin{lemma}The category of~$\TT$-models is complete and
cocomplete.\end{lemma}

\begin{proof}Limits are computed as the limits of the underlying sets, colimits
are computed by using the construction of Lemma~\ref{lemma:free-models}. For
instance, the coproduct of~$\TT\langle X | R \rangle$ and~$\TT\langle X' | R'
\rangle$ is~$\TT\langle X \amalg X' \,|\, R, R' \rangle$.\end{proof}

Having the special case of the theory of rings in mind, we write the coproduct
in the category of~$\TT$-models as~``$\otimes$''.

\begin{lemma}Let~$\sigma = (\varphi_1 \wedge \cdots \wedge \varphi_n
\seq{x_1,\ldots,x_k} \psi_1 \wedge \cdots \wedge \psi_m)$ be a Horn sequent
over the signature of~$\TT$. Then the following statements are equivalent.
\begin{enumerate}
\item The theory~$\TT$ proves~$\sigma$.
\item In~$\TT\langle x_1,\ldots,x_k | \varphi_1,\ldots,\varphi_n \rangle$, the
propositions~$\psi_1,\ldots,\psi_m$ hold for
the~$k$-tuple~$([x_1],\ldots,[x_k])$.
\end{enumerate}
\end{lemma}

\begin{proof}By construction of the term algebra.\end{proof}

\begin{lemma}A~$\TT$-model is finitely presentable as an object of the category
of~$\TT$-models if and only if it is isomorphic to a model of the
form~$\TT\langle X | R \rangle$ where~$X$ is Bishop-finite and~$R$ is
Kuratowski-finite.
\end{lemma}

\begin{proof}It is an instructive exercise to verify that models of the stated
form are compact. Conversely, let a~$\TT$-model~$M$ be given. Then~$\TT$ is the
filtered colimit of all models over~$M$ which are of the stated form. If~$M$ is
compact, the identity on~$M$ factors over such a model. Hence~$M$ is a
retract of such a model and hence itself isomorphic to a model of this form.
\end{proof}

% XXX Set[T] einfÃ¼hren

Any~$\TT$-model~$A$ has a mirror image in the topos~$\Set[\TT]$, namely the
functor~$A^\sim : \Mod{\TT}_\mathrm{fp} \to \Set$ given by~$T \mapsto A \otimes T$.
This object is in a canonical way a~$\TT$-model over~$U_\TT$, hence from the
point of view of~$\Set[\TT]$ a~$\ul{\TT}/U_\TT$-model.

\begin{lemma}The functor~$(\cdot)^\sim$ from~$\TT$-models to~$\ul{\TT}/U_\TT$-models
in~$\Set[\TT]$ is left adjoint to functor~$\Gamma = \Hom(1, \cdot)$ computing
global elements.
\end{lemma}

\begin{proof}An~$U_\TT$-algebra-homomorphism~$\alpha : A^\sim \to M$ yields
the~$\TT$-model-homo\-mor\-phism~$\alpha_0 : A \to M(0) = \Gamma(M)$, where~$0$ is the
initial~$\TT$-model. Conversely, a~$\TT$-model-homomorphism~$\beta : A \to
\Gamma(M)$ yields an~$U_\TT$-algebra-homomorphism by summing~$A \to M(0) \to
M(T)$ with the structure morphism~$T = U_\TT(T) \to
M(T)$.\end{proof}

\begin{defn}The \emph{spectrum}~$\Spec(M)$ of a~$U_\TT$-algebra~$M$ in~$\Set[\TT]$
is the result of constructing, internally to~$\Set[\TT]$, the set
of~$U_\TT$-algebra-homomorphisms~$M \to U_\TT$.
\end{defn}

Externally, the spectrum of~$M$ is the functor
mapping a finitely presented~$\TT$-model~$T$ to~$\Hom_T(M(T), T)$, the set
of~$\TT$-homomorphisms~$M(T) \to T$ compatible with the structure morphisms~$T
\to M(T)$ and~$T \to T$.

\begin{lemma}Let~$A$ be a~$\TT$-model. Then~$\Spec(A^\sim)$ coincides
with~$yA$, the functor~$\Hom_{\Mod{\TT}}(A, \cdot)$.
\end{lemma}

\begin{proof}XXX\end{proof}

\begin{lemma}Let~$A$ and~$B$ be finitely presented~$\TT$-models. Then the
canonical morphism
\[ \Hom_{U_\TT}(A^\sim, B^\sim) \longrightarrow \Spec(A^\sim)^{\Spec(B^\sim)}
\]
is an isomorphism.
\end{lemma}


\section{The generalization to the higher-order case}

\begin{thm}\label{thm:higher-order-nullstellensatz}
Let~$\TT$ be a geometric theory. Let~$x_1\?X_1,\ldots,x_n\?X_n$ be a context over the
signature of~$\TT$. Then the canonical morphism
\[ \mathrm{Form}^\star_{\vec x}(\ul{\TT}/U_\TT)/(\dashv\vdash_{\vec x}) \longrightarrow P(X_1 \times
\cdots \times X_n) \]
sending the equivalence class of a geometric$^\star$ formula~$\varphi$ over the
signature of~$\ul{\TT}/U_\TT$ to the subset~$\{ (x_1,\ldots,x_n) \,|\, \varphi
\}$ is an isomorphism.
% XXX explain equivalence relation
\end{thm}

An immediate corollary of Theorem~\ref{thm:definability} is the
Nullstellensatz of Theorem~\ref{thm:nullstellensatz}. Indeed, arguing
internally to~$\Set[\TT]$, let~$\sigma = (\varphi \seq{\vec x} \psi)$ be a
geometric$^\star$ sequent over the signature of~$\ul{\TT}/U_\TT$. Assume
that~$\sigma$ holds for~$U_\TT$. Then the subsets~$\{ (\vec x) \,|\, \varphi
\}$ and~$\{ (\vec x) \,|\, \varphi \wedge \psi \}$ are equal. Hence, by
Theorem~\ref{thm:definability}, the formulas~$\varphi$
and~$\varphi \wedge \psi$ are provably$^\star$ equivalent.
Thus~$\ul{\TT}/U_\TT$ proves$^\star$~$(\varphi \seq{\vec x} \psi)$.

\begin{cor}Let~$\TT$ be a geometric theory. Let~$\{\vec x\_ \varphi\}$
and~$\{\vec y\_ \psi\}$ be geometric formulas in given contexts. Then,
internally to~$\Set[\TT]$, the canonical map from the set of equivalence classes
of~$\ul{\TT}/U$-provably$^\star$ functional geometric$^\star$ formulas
from~$\{\vec x\_ \varphi\}$ to~$\{\vec y\_ \psi\}$ to the set of maps~$\{(\vec y)
\,|\, \psi \}^{\{(\vec x) \,|\, \varphi\}}$ is a bijection.
\end{cor}

% XXX fill in proof

\begin{thm}\label{thm:higher-order-nullstellensatz}
Let~$\TT$ be a geometric theory. Then, internally to~$\Set[\TT]$, for any
higher-order geometric$^\star$ sequent~$\sigma$ over the signature
of~$\ul{\TT}/U$, the following statements are equivalent:
\begin{enumerate}
\item The sequent~$\sigma$ holds for~$U_\TT$.
\item The sequent~$\sigma$ is provable$^\star$ modulo~$\TT/U_\TT$ in geometric
higher-order logic.
\end{enumerate}
\end{thm}

% XXX fill in proof

\begin{thm}\label{thm:higher-order-characterization}
Let~$\TT$ be a geometric theory. Let~$\alpha$ be a higher-order formula over
the signature of~$\TT$. Then the following statements are equivalent:
\begin{enumerate}
\item The formula~$\alpha$ holds for~$U_\TT$.
\item The formula~$\alpha$ is provable in higher-order intuitionistic logic
modulo the axioms of~$\TT$ and the additional axiom scheme~XXX.
\end{enumerate}
\end{thm}

% XXX fill in proof


\section{Applications}

% Zariski

% Kock--Lawvere in SDG

%We do have, for any geometric sequent~$\sigma$, that
%\[ \Set[\TT] \models \speak{$\sigma$ holds for~$U_\TT$} \quad\text{iff}\quad
%  \Set[\TT] \models \speak{$\ul{\TT}$ proves~$\sigma$}, \]
%since~$\Set[\TT] \models \speak{$\sigma$ holds for~$U_\TT$}$ implies that~$\TT$
%proves~$\sigma$ and since~$\TT \vdash \sigma$ implies~$\E \models
%(\ul{\TT} \vdash \sigma)$ for any topos~$\E$ over~$\Set$. However, this
%equivalence is not stable under slicing ...



\printbibliography

\end{document}

* Discuss case of SDG: Why does the Kock--Lawvere there hold only for Weil
  algebras? Answer: It doesn't really! We do have that [U,U] is isomorphic to
  the free C^â-ring on one generator. But this observation doesn't appear to be
  useful for further developments.

* Cite https://docplayer.net/55796150-Intuitionistic-algebra-some-recent-developments-in-topos-theory.html
  (in general and for internal theories)

* Discuss related work, especially: Olivia 6.1.3, ...

* Discuss higher-order case

\begin{defn}Let~$\TT$ be a geometric theory. The theory~$\ul{\TT}/U_\TT$ is the
geometric theory internal to~$\Set[\TT]$ which arises from~$\ul{\TT}$
by adding additional constant symbols~$e_x$, one for each
element~$x : U_\TT$, axioms~$(\top \vdash f(e_{x_1},\ldots,e_{x_n}) =
e_{f(x_1,\ldots,x_n)})$ for each function symbol~$f$ and~$n$-tuple of elements
of~$U_\TT$, and axioms~$(\top \vdash R(e_{x_1},\ldots,e_{x_n}))$ for each
relation symbol~$R$ and~$n$-tuple~$(e_{x_1},\ldots,e_{x_n})$ such
that~$R(e_{x_1},\ldots,e_{x_n})$ holds for~$U_\TT$.
\end{defn}

From the point of view of~$\Set[\TT]$, a model of~$\ul{\TT}/U_\TT$ is a model
of~$\ul{\TT}$ equipped with a~$\ul{\TT}$-homomorphism from~$U_\TT$. In
particular, the identity~$(U_\TT \to U_\TT)$ is a model of~$\ul{\TT}/U_\TT$.
We then have:

% We would not expect the statement
% \[ \text{``for any geometric sequent~$\sigma$, if~$\sigma$ holds for~$A$
% then the theory of rings proves~$\sigma$''} \]
% to hold for an ordinary ring~$A$ in the topos of sets.
%
% Let~$M$ be a~$\TT$-model. We then trivially have
% signature of~$\TT$. While we always have the implication
% \[ \text{$\TT$ proves~$\sigma$} \quad\Longrightarrow\quad
%   \text{$\sigma$ holds for~$M$}, \]
% the converse is of course typically false,
%
% Furthermore, in a first introduction, it is useful to
% restrict to an instructive special case, such as the theory of (commutative) rings.
%
% A simple version of the classical Nullstellensatz, valid for algebraically
% closed fields, states: Let~$f \in A[X]$ be a polynomial. If
% \[ \forall x \in A\_ (f(x) = 0 \in A \Rightarrow 1 = 0 \in A), \]
% then there is a polynomial~$g \in A[X]$ such that~$gf = 1$. This polynomial~$g$
% can be regarded as an ``algebraic certificate'' that the equation~$f(x) = 0$
% only has a solution in the trivial case~$1 = 0$. The conclusion can also be phrased as
% follows: In the free~$A$-algebra on one generator modulo the relation~$f(X) =
% 0$, the relation~$1 = 0$ holds.
%
% Let~$A$ be a specific ring. Let~$f,g \in \ZZ[X]$ be
% polynomials. While we always have the implication
% \[ g([X]) = 0 \in \ZZ[X]/(f) \quad\Longrightarrow\quad
%   \forall x \in A\_ (f(x) = 0 \Rightarrow g(x) = 0), \]
% the converse is typically false: Just that~$g(x) = 0$ holds for every zero
% of~$f$ in~$A$ does not imply that~$g([X]) = 0$ holds for the generic zero
% of~$f$ in the free ring on one generator~$X$ modulo the relation~$f(X) = 0$.
%
%
% the case that~$\TT$ is a Horn theory (where the axioms are of the
% form~$(\phi \seq{\vec x} \psi)$ with the formulas~$\phi$ and~$\psi$ being
% finite conjunctions of atomic propositions (equality and the given relations)),
% such that we can switch from a logical terminology to a more algebraic one.
% In the Horn case, for any set~$X$ and any set~$R$ of atomic propositions the
% term algebra construction yields~$\TT\langle X | R\rangle$, the
% free~$\TT$-model generated by~$X$ modulo the relations~$R$. We will also abuse
% notation to pretend that~$\TT$ is single-sorted.
%
% Let~$M$ be a specific~$\TT$-model and assume that for
% all~$n$-tuples~$x = (x_1,\ldots,x_n)$ of elements of~$M$, if some set~$R_1$ of
% atomic propositions is satisfied for~$x$ then so is some set~$R_2$. In this
% case it is unreasonable to expect that~$R_2$ holds for the~$n$-tuple of
% generators of~$\TT\langle e_1,\ldots,e_n | R_1\rangle$.
%
% let~$R_1$ and~$R_2$ be sets of atomic
% propositions with~$n$ free variables. Then
% and assume, for some sets of relations~$R_1$
% and~$R_2$
%
% The term algebra of a Horn theory~$\TT$ is always a model of~$\TT$, such that


* Sei T' subkanonisch fÃ¼r T.

* Sei Ï eine Hornformel. Gelte âÏ. Folgt dann Ï?

* FÃ¼r Ï = (x = y) stimmt das, da U separiert ist.

* FÃ¼r Ï = (R(x,y)) stimmt, das ...?

  Was heiÃt das denn? Habe R \--> U x U. Gehe davon aus, dass âÏ bedeutet, dass
  â((x,y) â R). Daraus folgt aber (x,y) â R:

  K = { (x,y) | (x,y) â R } ist Subsingleton von U x U und â-bewohnt.
  Also existiert (a,b) â U x U mit â... Hilft nicht.

  Aber: K = { (a,b) â R | a = x & b = y } ist Subsingleton von R.
  Und â-bewohnt. Also existiert (a,b) â R mit â(a=x & b = y).
  Wegen Separiertheit folgt a = x & b = y. Fertig. :-)


TODO:

* NichttrivialitÃ¤t des Nullstellensatzes diskutieren (Spezialfall top |- Ï
  betrachten, dieser ist nÃ¤mlich schon mehr oder weniger trivial)

* Anmerken, dass der Nullstellensatz fÃ¼r first-order sequents NICHT stimmt
  (Beispiel: Â¬(x=0) â (x inv.))

* Anmerken, dass wir in konstruktiver Metalogik arbeiten.
