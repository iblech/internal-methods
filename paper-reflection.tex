\documentclass[oneside,reqno]{amsart}

\usepackage[utf8]{inputenc}
\usepackage{amsthm,mathtools,stmaryrd,amssymb,graphicx}
\usepackage{booktabs}
\usepackage[all]{xy}
\usepackage[protrusion=true,expansion=true]{microtype}
\usepackage{xspace}

\usepackage[natbib=true,style=numeric,maxnames=10]{biblatex}
\usepackage[babel]{csquotes}
\bibliography{paper-filmat.bib}

\graphicspath{{images/}}

\usepackage{pifont}
\newcommand{\cmark}{\ding{51}}
\newcommand{\xmark}{\ding{55}}

\title[]{Reflections on reflection for \\ intuitionistic set theories}
\author{}
\email{iblech@speicherleck.de}

\theoremstyle{definition}
\newtheorem{defn}{Definition}[section]
\newtheorem{ex}[defn]{Example}

\theoremstyle{plain}
\newtheorem{prop}[defn]{Proposition}
\newtheorem{cor}[defn]{Corollary}
\newtheorem{lemma}[defn]{Lemma}
\newtheorem{thm}[defn]{Theorem}
\newtheorem{scholium}[defn]{Scholium}

\theoremstyle{remark}
\newtheorem{rem}[defn]{Remark}
\newtheorem{question}[defn]{Question}
\newtheorem{speculation}[defn]{Speculation}
\newtheorem{caveat}[defn]{Caveat}
\newtheorem{conjecture}[defn]{Conjecture}

\newcommand{\xra}[1]{\xrightarrow{#1}}
\newcommand{\XXX}[1]{\textbf{XXX: #1}}
\newcommand{\aaa}{\mathfrak{a}}
\newcommand{\bbb}{\mathfrak{b}}
\newcommand{\mmm}{\mathfrak{m}}
\newcommand{\I}{\mathcal{I}}
\newcommand{\J}{\mathcal{J}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\B}{\mathcal{B}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\ZZ}{\mathbb{Z}}
\renewcommand{\SS}{\mathbb{S}}
\renewcommand{\P}{\mathcal{P}}
\renewcommand{\O}{\mathcal{O}}
\newcommand{\defeq}{\vcentcolon=}
\newcommand{\op}{\mathrm{op}}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Mod}{Mod}
\DeclareMathOperator{\Sh}{Sh}
\DeclareMathOperator{\PSh}{PSh}
\DeclareMathOperator{\rank}{rank}
\newcommand{\Set}{\mathrm{Set}}
\newcommand{\Eff}{\mathrm{Ef{}f}}
\renewcommand{\_}{\mathpunct{.}\,}
\newcommand{\effective}{ef{}fective\xspace}
\newcommand{\?}{\,{:}\,}
\newcommand{\realizes}{\Vdash}
\newcommand{\notnot}{\emph{not~not}\xspace}

\newcommand{\stacksproject}[1]{\cite[{\href{https://stacks.math.columbia.edu/tag/#1}{Tag~#1}}]{stacks-project}}

\renewcommand{\paragraph}[1]{\noindent\textbf{#1.}}

\newcommand{\ZF}{\textsc{zf}}
\newcommand{\IZF}{\textsc{izf}}
\newcommand{\CZF}{\textsc{czf}}
\newcommand{\ZFC}{\textsc{zfc}}
\newcommand{\ZFCS}{\textsc{zfc/s}}
\newcommand{\RRS}{\textsc{rrs}}
\newcommand{\ES}{(\IZF+\RRS)/\textsc{s}}

\begin{document}

\begin{abstract}
  We study the well-known reflection principle of Zermelo--Fraenkel set theory
  in the context of intuitionistic Zermelo--Fraenkel set theory~$\IZF$. We show
  that the reflection principle is equivalent to Aczel's relation reflection scheme~$\RRS$. As
  applications, we give a new proof that relativized dependent choice is
  equivalent to the conjunction of~$\RRS$ and dependent choice and we present
  an intuitionistic version of Feferman's~$\ZFC/S$, a conservative extension
  of~$\ZFC$ which is useful as a foundation for category theory.
\end{abstract}

\maketitle
\thispagestyle{empty}

\section{Introduction}

In its basic form, the reflection principle for Zermelo--Fraenkel set
theory~$\ZF$ states:
\begin{thm}Let~$\varphi(x_1,\ldots,x_n)$ be a formula in the language of set
theory with free variables as indicated. Then~$\ZF$ proves
\[ \forall M\_
  \exists S \supseteq M\_
  \forall x_1,\ldots,x_n \in S\_
  \varphi(x_1,\ldots,x_n) \Leftrightarrow \varphi^S(x_1,\ldots,x_n), \]
where~$\varphi^S$ is the~$S$-relativization of~$\varphi$, obtained by
substituting any occurence of~``$\forall x$'' and~``$\exists x$'' by~``$\forall
x \in S$'' and~``$\exists x \in S$''.
\end{thm}
Furthermore, the resulting set~$S$ may be supposed to be transitive, closed
under subsets or even to be a stage~$V_\alpha$ of the cumulative hierarchy.
% XXX: "hence" instead of "or even"?

The reflection principle is important both for philosophical and for practical
reasons: Philosophically, it tells us that truth of any formula can already be
checked in an initial segment of the universe. Practically, it allows to
transfer results obtained for a restricted class of objects to all such
objects. For instance, if we manage to verify (the $S$-relativization of) some
group-theoretic statement for all groups contained in an arbitrary set~$X$,
then we may deduce by the reflection principle that in fact the statement holds
for all groups in the universe.

This observation has been used by Feferman to construct~$\ZFCS$ (``$\ZFC$ with
smallness''), a conservative extension of~$\ZFC$ which provides a useful
foundation of category theory~\cite{feferman:zfcs}. This theory extends~$\ZFC$
by the addition of a new constant symbol~$\SS$ together with axioms stating
that~$\SS$ is transitive, closed under subsets and reflective with respect to
every formula~$\varphi(x_1,\ldots,x_n)$ of the original language:
\[ \label{ax:refl}\tag{$\star$}
\forall x_1,\ldots,x_n \in \SS\_ \varphi(x_1,\ldots,x_n) \Leftrightarrow
\varphi^{\SS}(x_1,\ldots,x_n). \]
This theory is conservative over~$\ZFC$ because any given proof in~$\ZFCS$ uses
only a finite number of instances of this axiom scheme and hence the reflection
principle yields a honest set~$S$ which validates just the same equivalences.

Elements of~$\SS$ are deemed ``small'', so that~$\SS$ is the set of all small
sets. The system~$\ZFCS$ is useful as a foundation for category theory because
it allows a native treatment of large structures -- for instance, the category
of all small sets can be formed entirely withing~$\ZFCS$, without resorting to
classes -- while not requiring new set-theoretical commitments such as the
existence of Grothendieck universes. We invite the reader who wants to learn
more about the merits of~$\ZFCS$ to a survey by
Shulman~\cite[Section~11]{shulman:sets}.

To our naive eyes, the passage from~$\ZFC$ to~$\ZFCS$ looked sufficiently
innocent so that we set out to create an intuitionistic version of~$\ZFCS$: To
our mind, size issues were entirely separate from issues of constructivity, and
we hence opined that they should be dealt with separately. Such a separation
would lead to improved mental hygiene and would allow us to use the benefits
of~$\ZFCS$ in situations where the law of excluded middle and the axiom of
choice are not available, such as in realizability semantics, sheaf semantics
or quite generally topos semantics.

We expected this modification to be entirely straightforward. However, the
situation turned out to be more subtle and we failed in our original goal of
verifying the reflection principle for intuitionistic Zermelo--Fraenkel set
theory~$\IZF$. The situation for~$\CZF$, the predicative subtheory of~$\IZF$
commonly heralded as the largest common denominator of all flavors of
constructive set theory, is even more mysterious.

More specifically, the main result of this note is the following.

\begin{thm}The reflection principle is equivalent, over~$\IZF$, to Aczel's relation reflection
scheme~$\RRS$.\end{thm}

Aczel's relation reflection scheme will be reviewed below. It is validated by
all known models of~$\IZF$, hence might be regarded as not entirely
unconstructive, even though it's conjectured to be independent of~$\IZF$. As a
result, the question whether the reflection principle holds for~$\IZF$ remains
open (though conjectured to be false), and for the stronger system~$\IZF+\RRS$
we can give a variant ``with smallness'' which can serve as a set-theoretic
foundation for category theory.

\begin{conjecture}The system $\IZF$ does not prove the reflection
principle.\end{conjecture}

\begin{defn}The system $\ES$ is obtained from~$\IZF+\RRS$ by
adding a constant symbol~$\SS$ together with axioms
stating that~$\SS$ is transitive, closed under subsets and reflective for all
formulas of the original language (that is, adding one instance
of~\eqref{ax:refl} for each formula of~$\IZF$).\end{defn}

\begin{cor}The system~$\ES$ is conservative
over~$\IZF+\RRS$.\end{cor}

This note is organized as follows. Section~1 reviews the classical proof of the
reflection principle in the context of~$\ZF$ set theory. Section~2 reviews
Aczel's relation reflection scheme and presents our main result. We conclude in
Section~3 and Section~4 with two short applications.

\textbf{Acknowledgments.} XXX


\section{Review of the classical reflection principle}

A basic proof of the reflection principle for~$\ZF$ runs as follows. Our proof
of the reflection principle for~$\IZF+\RRS$ will follow the same outline.

\begin{lemma}\label{lemma:zf-onestep}
Let~$\varphi(u_1,\ldots,u_n,x)$ be a formula in the language of set
theory with free variables as indicated. Then~$\ZF$ proves
\begin{multline*}
  {\qquad}\forall M\_
  \exists S \supseteq M\_
  \forall u_1,\ldots,u_n \in S\_ \\
  (\exists x\_ \varphi(u_1,\ldots,u_n,x)) \Longrightarrow
  (\exists x \in S\_ \varphi(u_1,\ldots,u_n,x)).{\qquad}
\end{multline*}
Furthermore:
\begin{enumerate}
\item We may suppose that~$S$ is transitive.
\item We may suppose that~$S$ is closed under subsets.
\item Given a finite list~$\varphi_1,\ldots,\varphi_k$ of formulas instead of
the single formula~$\varphi$, we may suppose that~$S$ bounds all of
the~$\varphi_i$.
% XXX: better explanation
\end{enumerate}
\end{lemma}

\begin{proof}Given a class~$X$ (as commonly understood as the comprehension of
a formula), we denote by~$X^\sim$ its subclass~$\{ x \in X \,|\, \forall y
\in X\_ \rank(x) \leq \rank(y) \}$, where the rank function refers to the stage
in the cumulative hierarchy. The two fundamental properties of this construction are:
This subclass is equal to a set,\footnote{If~$X$ is empty, then
this claim is trivial; if~$X$ is inhabited by some element~$x_0$, then~$X^\sim$ can
be obtained using separation from~$V_{\rank(x_0)+1}$; and in fact, by an argument
using the set of truth values and unbounded separation, the claim can also be
proven in~$\IZF$.} and it is inhabited if and only if~$X$ is.

Starting with~$S_0 \defeq M$, we construct~$S_{k+1}$ from~$S_k$ as the union of
sets
\[ S_{k+1} \defeq S_k \cup \bigcup_{u_1,\ldots,u_n \in S_k} \{ x \,|\,
\varphi(u_1,\ldots,u_n,x) \}^\sim. \]
It is then easy to check that~$S \defeq \bigcup_{k \in \NN} S_k$ has the
required property.

For addendum~(1), we redeclare~$S \defeq \bigcup_{k \in \NN} S_k'$,
where~$S_k'$ is the transitive closure of~$S_k$.

To ensure both addendum~(1) and addendum~(2), we redeclare~$S \defeq \bigcup_{k
\in \NN} P^\omega(S_k')$, where~$P^\omega(X) \defeq \bigcup_{\ell \in \NN}
P^{(\ell)}(X)$ is the union of iterated powersets.

For addendum~(3), we change the definition of~$S_{k+1}$ to include one summand
for each formula~$\varphi_i$.
\end{proof}

The proof of Lemma~\ref{lemma:zf-onestep} is mostly constructive; however,
there is one issue with nontrivial ramifications: While~$\IZF$ does still show
that the subclass~$X^\sim$ of a given class~$X$ is a set, it does not verify
that~$X^\sim$ is inhabited if~$X$ is. This would amount to the constructive
taboo that any inhabited set contains a rank-minimal element; and in fact, by
a result of Friedman and Scedrov~\cite{XXX}, no definable substitute
for~$X^\sim$ exists. The remedy presented in
Section~\ref{sect:constructive-proof} will construct~$X^\sim$ in a non-unique
fashion and then take the union using some additional care.

\begin{thm}\label{thm:zf-bigstep}
Let~$\varphi(x_1,\ldots,x_n)$ be a formula in the language of set
theory with free variables as indicated. Then~$\ZF$ proves
\[ \forall M\_
  \exists S \supseteq M\_
  \forall x_1,\ldots,x_n \in S\_
  \varphi(x_1,\ldots,x_n) \Leftrightarrow \varphi^S(x_1,\ldots,x_n), \]
where~$\varphi^S$ is the~$S$-relativization of~$\varphi$.
\end{thm}

\begin{proof}Let a set~$M$ be given. We obtain~$S$ by applying
Lemma~\ref{lemma:zf-onestep} to the list of all subformulas of~$\varphi$. We
then verify that~$S$ has the required property by an induction on the structure
of~$\varphi$. The cases~$\text{``$=$''}, \text{``$\in$''}, \text{``$\top$''},
\text{``$\bot$''}, \text{``$\wedge$''},
\text{``$\vee$''}, \text{``$\Rightarrow$''}$ follow
trivially from the induction hypothesis. The case~``$\forall$'' does
not need to be treated, since we may assume without loss of generality that all
universal quantifiers in~$\varphi$ have been rewritten
as~``$\neg\exists\neg$''.

The remaining case is where~$\varphi$ is of the form~$\varphi \equiv (\exists
x\_ \psi(u_1,\ldots,u_m,x))$. In this case, the claim is that
\[ \forall u_1,\ldots,u_m \in S\_
  (\exists x\_ \psi(u_1,\ldots,u_m,x)) \Longrightarrow
  (\exists x \in S\_ \psi^S(u_1,\ldots,u_m,x)), \]
and this follows by the property of~$S$ guaranteed by
Lemma~\ref{lemma:zf-onestep} and by the induction hypothesis concerning the
subformula~$\psi^S(u_1,\ldots,u_m,x)$.
\end{proof}

The proof of Theorem~\ref{thm:zf-bigstep} is constructive with the sole
exception of treating the case of universal quantifiers by appealing to the law
of excluded middle. For the constructive proof in
Section~\ref{sect:constructive-proof}, we will instead appeal to a strengthened
version of Lemma~\ref{lemma:zf-onestep}.

\end{document}

% XXX: Topos which validates exactly those statements which are true
% externally.

% XXX: Review axioms of IZF.
